(function(g){var window=this;'use strict';var jVr=function(A){var n=new g.nd("und",new g.Nx("Default","und",!0));n.captionTracks=A.captionTracks;return n},rRD=function(A){return new g.C1(function(n,O){var L=A.length,J=[];
if(L)for(var S=function(t,l){L--;J[t]=l;L==0&&n(J)},N=function(t){O(t)},G,b=0;b<A.length;b++)G=A[b],g.AVY(G,g.Fa(S,b),N);
else n(J)})},yT=function(A){this.U=A},Ie=function(){yT.apply(this,arguments)},afW=function(){Ie.apply(this,arguments)},u3N=function(){Ie.apply(this,arguments)},P63=function(){Ie.apply(this,arguments)},yRr=function(){Ie.apply(this,arguments)},If6=function(){Ie.apply(this,arguments)},QVc=function(){Ie.apply(this,arguments)},$8N=function(){yT.apply(this,arguments)},vIh=function(){Ie.apply(this,arguments)},BJW=function(){Ie.apply(this,arguments)},Vep=function(){Ie.apply(this,arguments)},RPD=function(){Ie.apply(this,
arguments)},hPw=function(){Ie.apply(this,arguments)},zP6=function(){Ie.apply(this,arguments)},oIN=function(){Ie.apply(this,arguments)},qIp=function(){Ie.apply(this,arguments)},kLL=function(){Ie.apply(this,arguments)},wvc=function(){Ie.apply(this,arguments)},WjK=function(){Ie.apply(this,arguments)},ePX=function(){Ie.apply(this,arguments)},Fjw=function(){yT.apply(this,arguments)},XvR=function(){Ie.apply(this,arguments)},ZT6=function(){Ie.apply(this,arguments)},AIR=function(){Ie.apply(this,arguments)},
naw=function(){Ie.apply(this,arguments)},OXV=function(){Ie.apply(this,arguments)},Lo3=function(){Ie.apply(this,arguments)},JIh=function(){Ie.apply(this,arguments)},SD3=function(){Ie.apply(this,arguments)},Nvr=function(){Ie.apply(this,arguments)},cIw=function(){yT.apply(this,arguments)},GQh=function(){yT.apply(this,arguments)},bXW=function(){yT.apply(this,arguments)},trL=function(){Ie.apply(this,arguments)},l3V=function(){Ie.apply(this,arguments)},DhN=function(){Ie.apply(this,arguments)},YDK=function(){Ie.apply(this,
arguments)},mhp=function(){Ie.apply(this,arguments)},TvN=function(){Ie.apply(this,arguments)},dhK=function(){Ie.apply(this,arguments)},xhh=function(){Ie.apply(this,arguments)},f3p=function(){Ie.apply(this,arguments)},Ko6=function(){Ie.apply(this,arguments)},EaW=function(){Ie.apply(this,arguments)},C4p=function(){Ie.apply(this,arguments)},iX3=function(){Ie.apply(this,arguments)},MrX=function(){Ie.apply(this,arguments)},pUw=function(){Ie.apply(this,arguments)},Uhw=function(){Ie.apply(this,arguments)},
HXV=function(){Ie.apply(this,arguments)},sp6=function(){Ie.apply(this,arguments)},gaV=function(){Ie.apply(this,arguments)},jpD=function(){Ie.apply(this,arguments)},rIr=function(){Ie.apply(this,arguments)},a3p=function(){Ie.apply(this,arguments)},u4h=function(){Ie.apply(this,arguments)},P4R=function(){Ie.apply(this,arguments)},yId=function(){Ie.apply(this,arguments)},I3d=function(){Ie.apply(this,arguments)},Qp6=function(){yT.apply(this,arguments)},$hc=function(){Ie.apply(this,arguments)},vaV=function(){Ie.apply(this,
arguments)},BvW=function(){Ie.apply(this,arguments)},Vr3=function(){Ie.apply(this,arguments)},RC6=function(){Ie.apply(this,arguments)},hCN=function(){Ie.apply(this,arguments)},zCp=function(){Ie.apply(this,arguments)},oaW=function(){Ie.apply(this,arguments)},qD3=function(){Ie.apply(this,arguments)},kQp=function(){Ie.apply(this,arguments)},wUR=function(){Ie.apply(this,arguments)},Woc=function(){Ie.apply(this,arguments)},eC6=function(){Ie.apply(this,arguments)},FoN=function(){Ie.apply(this,arguments)},
XU3=function(){Ie.apply(this,arguments)},ZXc=function(){Ie.apply(this,arguments)},AtR=function(){Ie.apply(this,arguments)},n5w=function(){Ie.apply(this,arguments)},OiN=function(){Ie.apply(this,arguments)},LaN=function(){Ie.apply(this,arguments)},Jtw=function(){Ie.apply(this,arguments)},S3r=function(){Ie.apply(this,arguments)},NBc=function(){Ie.apply(this,arguments)},ctK=function(){Ie.apply(this,arguments)},GkX=function(){Ie.apply(this,arguments)},bi6=function(){Ie.apply(this,arguments)},tMc=function(){Ie.apply(this,
arguments)},low=function(){Ie.apply(this,arguments)},DmL=function(){Ie.apply(this,arguments)},Y3L=function(A){A=A.key||A.id;
if(!A)throw Error("Entity key is missing");return A},mm6=function(){if(QT)return QT();
var A={};QT=g.b$("PersistentEntityStoreDb",{Za:(A.EntityStore={H2:1},A.EntityAssociationStore={H2:2},A),shared:!1,upgrade:function(n,O){O(1)&&g.o7(g.vV(n,"EntityStore",{keyPath:"key"}),"entityType","entityType");O(2)&&(n=g.vV(n,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.o7(n,"byParentEntityKey","parentEntityKey"),g.o7(n,"byChildEntityKey","childEntityKey"))},
version:3});return QT()},TBN=function(A){return g.Zd(mm6(),A)},dmc=function(A){return g.Zd((0,g.GJX)(),A)},$y=function(A){this.token=A},va=function(A,n){n=n===void 0?{}:n;
g.OU.call(this,g.bgX[A],Object.assign({},{name:"PESEncoderError",type:A},n));this.type=A;this.level="WARNING";Object.setPrototypeOf(this,va.prototype)},xmV=function(A){return new va("WRONG_DATA_TYPE",{pK:A})},foD=function(A){return A instanceof Error?new va("UNKNOWN_ENCODE_ERROR",{fA:A.message}):new va("UNKNOWN_ENCODE_ERROR")},KaV=function(A){return A instanceof Error?new va("UNKNOWN_DECODE_ERROR",{fA:A.message}):new va("UNKNOWN_DECODE_ERROR")},E56=function(A,n){A=A instanceof va?A:n(A);
g.Vd(A);throw A;},Cqc=function(){},iiN=function(A,n,O){try{return A.C(n,O)}catch(L){E56(L,foD)}},MMd=function(A){A=(new TextEncoder).encode(A).subarray(0,16);
var n=new Uint8Array(16);n.set(A);return n},Ba=function(A){this.U=A},UmN=function(A){var n=p4D[A];
if(n)return n;g.R5(new g.OU("Entity model not found.",{entityType:A}))},Hip=function(A,n){this.U=A;
this.J=n;this.C={}},g5c=function(A,n){a:{A=sq6(A.J,n.version);
try{var O=A.J(n.data,n.key);break a}catch(L){E56(L,KaV)}O=void 0}return O},VT=function(A,n,O){return A.U.objectStore("EntityStore").get(n).then(function(L){if(L){if(O&&L.entityType!==O)throw Error("Incorrect entity type");
return g5c(A,L)}})},Re=function(A,n,O){return O?(O=O.map(function(L){return VT(A,L,n)}),g.uO.all(O)):A.U.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(n)).then(function(L){return L.map(function(J){return g5c(A,J)})})},zz=function(A,n,O){var L=Y3L(n),J=sq6(A.J,1),S=Object.assign({},n);
return A.U.objectStore("EntityStore").get(L).then(function(N){if(N){if(N.entityType!==O)throw Error("Incorrect entity type");S.entityMetadata||(N=g5c(A,N),S.entityMetadata=N.entityMetadata)}}).then(function(){var N={key:L,
entityType:O,data:iiN(J,S,L),version:1};return g.uO.all([g.R7(A.U.objectStore("EntityStore"),N),jqK(A,S,O)])}).then(function(){hv(A,L,O);
return L})},rt6=function(A,n,O){n=n.map(function(L){return zz(A,L,O)});
return g.uO.all(n)},oe=function(A,n,O){if(O==null?0:O.kJ){var L=new Set;
return ao6(A,n,L).then(function(){for(var S=[],N=g.f(L),G=N.next();!G.done;G=N.next())S.push(oe(A,G.value));return g.uO.all(S).then(function(){})})}var J=g.DP(n).entityType;
return g.uO.all([A.U.objectStore("EntityStore").delete(n),u63(A,n)]).then(function(){hv(A,n,J)})},Pqc=function(A,n){return g.WV(A.U.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(n)},function(O){return g.uO.all([O.delete(),
u63(A,O.cursor.primaryKey)]).then(function(){hv(A,O.cursor.primaryKey,n);return g.kJ(O)})})},ytc=function(A,n,O,L){var J=sq6(A.J,1);
return VT(A,n,L).then(function(S){if(S){S=g.ia(S,O);var N={key:n,entityType:L,data:iiN(J,S,n),version:1};return g.uO.all([g.R7(A.U.objectStore("EntityStore"),N),jqK(A,S,L)])}}).then(function(){hv(A,n,L);
return n})},hv=function(A,n,O){var L=A.C[O];
L||(L=new Set,A.C[O]=L);L.add(n)},Ioh=function(A,n,O){var L=Y3L(n);
O=UmN(O);if(!O)return g.uO.resolve([]);O=new O(n);A=A.U.objectStore("EntityAssociationStore");n=[];O=g.f(O.J());for(var J=O.next();!J.done;J=O.next())n.push(g.R7(A,{parentEntityKey:L,childEntityKey:J.value}));return g.uO.all(n).then(function(S){return S.map(function(N){return N[1]})})},u63=function(A,n){return A.U.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(n))},jqK=function(A,n,O){var L=Y3L(n);
return u63(A,L).then(function(){return Ioh(A,n,O)})},ao6=function(A,n,O){if(O.has(n))return g.uO.resolve(void 0);
O.add(n);return QqR(A,n).then(function(L){return A.U.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(n)).then(function(){return L})}).then(function(L){var J=g.uO.resolve(void 0);
L=g.f(L);for(var S=L.next(),N={};!S.done;N={RI:void 0},S=L.next())N.RI=S.value,J=J.then(function(G){return function(){return ao6(A,G.RI,O)}}(N));
return J}).then(function(){})},QqR=function(A,n){var O=A.U.objectStore("EntityAssociationStore");
return O.index("byParentEntityKey").getAll(IDBKeyRange.only(n)).then(function(L){var J=[];L=g.f(L);for(var S=L.next();!S.done;S=L.next())S=S.value,J.push(O.index("byChildEntityKey").getAll(S.childEntityKey));return g.uO.all(J)}).then(function(L){var J=[];
L=g.f(L);for(var S=L.next();!S.done;S=L.next())S=S.value,S.length===1&&J.push(S[0].childEntityKey);return J})},q3=function(){},$mr=function(){this.U={};
this.U[0]=new q3;if(!g.jU("aes_pes_encoder_killswitch")){var A=this.U;try{var n=g.L4();var O=MMd(n);var L=new Ba(new g.gq(O),new g.s0(O))}catch(J){throw A=J instanceof Error?new va("KEY_CREATION_FAILED",{fA:J.message}):new va("KEY_CREATION_FAILED"),g.Vd(A),A;}A[1]=L}},sq6=function(A,n){n=n===void 0?0:n;
A=A.U[n];if(!A)throw n=new va("INVALID_ENCODER_VERSION",{pK:n}),g.Vd(n),n;return A},ky=function(A,n){g.V.call(this);
this.token=A;this.U=n;this.observers=[];A=new g.vj.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.L4());A.onmessage=this.J.bind(this);this.channel=A},wT=function(A,n,O){var L,J,S,N;
return g.P(function(G){if(G.U==1)return g.a(G,TBN(A.token),2);if(G.U!=3)return L=G.J,g.a(G,g.Vs(L,["EntityStore","EntityAssociationStore"],n,function(b){J=new Hip(b,A.U);return O(J)}),3);
S=G.J;J&&(N=J.C,Object.keys(N).length>0&&(A.channel.postMessage(N),v5X(A,N)));return G.return(S)})},Wa=function(A,n,O){return wT(A,{mode:"readwrite",
iA:!0},function(L){return zz(L,n,O)})},BBW=function(A,n){return wT(A,{mode:"readwrite",
iA:!0},function(O){return rt6(O,n,"offlineOrchestrationActionWrapperEntity")})},VMN=function(A,n){return wT(A,{mode:"readwrite",
iA:!0},function(O){return oe(O,n)})},RSL=function(A){return wT(A,{mode:"readwrite",
iA:!0},function(n){return Pqc(n,"videoPlaybackPositionEntity")})},e2=function(A,n,O){return wT(A,{mode:"readonly",
iA:!0},function(L){return VT(L,n,O)})},FK=function(A,n,O){return wT(A,{mode:"readonly",
iA:!0},function(L){return Re(L,n,O)})},v5X=function(A,n){A=g.f(A.observers);
for(var O=A.next();!O.done;O=A.next())O=O.value,O(n)},hSr=function(){var A,n,O;
return g.P(function(L){if(L.U==1)return g.EC(L,2),g.a(L,g.cu(),4);if(L.U!=2){A=L.J;if(!A||!g.J3()||typeof g.vj.BroadcastChannel==="undefined")return L.return();n=new $mr;return L.return(new ky(A,n))}O=g.M5(L);O instanceof Error&&g.Vd(O);return L.return()})},XK=function(){zSV||(zSV=hSr());
return zSV},o5p=function(A){var n;
A=(n=A.options)==null?void 0:n.persistenceOption;return A==="ENTITY_PERSISTENCE_OPTION_PERSIST"||A==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},q3K=function(A){var n;
return g.P(function(O){return O.U==1?g.a(O,XK(),2):(n=O.J)?g.a(O,wT(n,"readwrite",function(L){for(var J={},S=g.f(A),N=S.next(),G={};!N.done;G={Ij:void 0,Ix:void 0},N=S.next())G.Ij=N.value,G.Ij.entityKey&&o5p(G.Ij)&&(G.Ix=g.Uf(G.Ij.payload),N=void 0,G.Ij.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(N=function(b){return function(){return zz(L,b.Ij.payload[b.Ix],b.Ix)}}(G)),G.Ij.type==="ENTITY_MUTATION_TYPE_DELETE"&&(N=function(b){return function(){return oe(L,b.Ij.entityKey)}}(G)),G.Ij.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(N=function(b){return function(){return ytc(L,b.Ij.entityKey,b.Ij.payload[b.Ix],b.Ix)}}(G)),N&&(J[G.Ij.entityKey]=J[G.Ij.entityKey]?J[G.Ij.entityKey].then(N):N()));
return g.uO.all(Object.values(J))}),0):O.return()})},kkp=function(A){var n;
return g.P(function(O){if(O.U==1){n=A.mutations;if(!n||n.length<=0)return O.return();if(g.Zw){var L={type:"ENTITY_LOADED"};n!==void 0&&(L.payload=n);g.Zw.dispatch(L)}return g.a(O,q3K(n),2)}n.length=0;g.Kx(O)})},w4d=function(A){return A!==void 0},Wap=function(A){var n=g.HJ();
n=Object.assign({},n);A=Object.assign({},A);for(var O in n)A[O]?(n[O]!==4&&(n[O]=A[O]),delete A[O]):n[O]!==2&&(n[O]=4);Object.assign(n,A);g.k0k(n);JSON.stringify(n);return n},eSw=function(A){var n,O;
return g.P(function(L){if(L.U==1)return g.a(L,g.cu(),2);if(L.U!=3)return(n=L.J)?g.a(L,g.j3(n),3):L.return();O=L.J;return L.return(g.Vs(O,["index","media","captions"],{mode:"readwrite",iA:!0},function(J){var S=IDBKeyRange.bound(A+"|",A+"~");J=[J.objectStore("index").delete(S),J.objectStore("media").delete(S),J.objectStore("captions").delete(S)];return g.uO.all(J).then(function(){})}))})},FaR=function(){var A,n;
return g.P(function(O){if(O.U==1)return g.a(O,g.cu(),2);if(O.U!=3){A=O.J;if(!A)throw g.r5("rvdfd");return g.a(O,g.j3(A),3)}n=O.J;return O.return(g.Vs(n,["index","media"],{mode:"readwrite",iA:!0},function(L){var J={};return g.qZ(L.objectStore("index"),{},function(S){var N=S.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),G=g.uO.resolve(void 0);if(N){var b=N[1];N=N[2];J[b]=J[b]||{};var t;J[b][N]=g.Xw5((t=S.getValue())==null?void 0:t.fmts)}else G=S.delete().then(function(){});
return g.uO.all([g.kJ(S),G]).then(function(l){return g.f(l).next().value})}).then(function(){for(var S={},N=g.f(Object.keys(J)),G=N.next();!G.done;G=N.next()){G=G.value;
var b=J[G].v;S[G]=J[G].a&&b?1:2}var t=Wap(S);return g.uw1(L.objectStore("media"),{},function(l){var D=l.cursor.key.match(g.O_R);D&&S[D[1]]||L.objectStore("media").delete(l.cursor.key);return g.M8C(l)}).then(function(){return t})})}))})},X4K=function(A,n){var O,L;
return g.P(function(J){if(J.U==1)return g.a(J,g.cu(),2);if(J.U!=3){O=J.J;if(!O)throw g.r5("wct");return g.a(J,g.j3(O),3)}L=J.J;return g.a(J,g.Vs(L,["captions"],{mode:"readwrite",iA:!0},function(S){var N=[];S=S.objectStore("captions");for(var G=0;G<n.length;G++){var b=g.R7(S,n[G],A+"|"+n[G].metadata.vss_id);N.push(b)}return g.uO.all(N)}),0)})},ZiN=function(A){var n,O,L;
return g.P(function(J){if(J.U==1)return n=IDBKeyRange.bound(A+"|",A+"~"),g.a(J,g.cu(),2);if(J.U!=3){O=J.J;if(!O)throw g.r5("gactfv");return g.a(J,g.j3(O),3)}L=J.J;return J.return(L.getAll("captions",n))})},AKd=function(A){return g.P(function(n){g.g$(A,0);
return n.return(eSw(A))})},nlr=function(A){return{context:g.m7(),
videoIds:A}},OnW=function(A){return{context:g.m7(),
playlistIds:A}},LDK=function(A){return{context:g.m7(),
offlinePlaylistSyncChecks:A}},JKw=function(){this.U=new Map},N03=function(){Sbr||(Sbr=new JKw);
return Sbr},cKR=function(A,n){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:A},metadata:n,statusCode:void 0,csn:void 0,can:void 0}},GiR=function(A,n,O){if(!O){var L=L===void 0?!1:L;
O=A.U.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!O||L)O=g.r_(16),A.U.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",O)}A={flowNonce:O,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:n.eventType};n.metadata&&(A.flowMetadata=n.metadata);n.statusCode!==void 0&&(A.flowEventStatus=n.statusCode);n.csn&&(A.csn=n.csn);n.can&&(A.can=n.can);g.f4("flowEvent",A,void 0)},bnV=function(A){var n,O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I,B,q,W,Ju,cj,Au,z,F,x,k,ZU,CW,nW,sC,e5,LW,dd,M,U,r;
return g.P(function(y){if(y.U==1)return g.a(y,wT(A,{mode:"readonly",iA:!0},function(v){return Re(v,"playbackData").then(function(OC){var S5=OC.map(function(dR){return dR.transfer}).filter(function(dR){return!!dR}),N5=OC.map(function(dR){return dR.offlineVideoPolicy}).filter(function(dR){return!!dR}),Q=OC.filter(function(dR){return!!dR.key}).map(function(dR){return g.YU(g.DP(dR.key).entityId,"downloadStatusEntity")});
S5=Re(v,"transfer",S5);N5=Re(v,"offlineVideoPolicy",N5);Q=Re(v,"downloadStatusEntity",Q);var lj=S5.then(function(dR){dR=dR.reduce(function(bj,aa){(aa==null?0:aa.offlineVideoStreams)&&bj.push.apply(bj,g.E(aa.offlineVideoStreams));return bj},[]).filter(function(bj){return!!bj});
return Re(v,"offlineVideoStreams",dR)});
return g.uO.all([S5,N5,lj,Q]).then(function(dR){var bj=g.f(dR);dR=bj.next().value;var aa=bj.next().value;var YV=bj.next().value;bj=bj.next().value;return[OC,dR,aa,YV,bj]})})}),2);
if(y.U!=3)return n=y.J,g.a(y,wT(A,{mode:"readonly",iA:!0},function(v){return Re(v,"mainDownloadsListEntity").then(function(OC){var S5,N5;return(N5=(S5=OC[0])==null?void 0:S5.downloads)!=null?N5:[]})}),3);
O=y.J;L=g.f(n);J=L.next().value;S=L.next().value;N=L.next().value;G=L.next().value;b=L.next().value;t=J;l=S;D=N;Y=G;m=b;T={};K={};C={};p={};H={};u=[];I=g.f(l);for(B=I.next();!B.done;B=I.next())(q=B.value)&&(T[q.key]=q);W=g.f(D);for(Ju=W.next();!Ju.done;Ju=W.next())(cj=Ju.value)&&(K[cj.key]=cj);Au=g.f(m);for(z=Au.next();!z.done;z=Au.next())(F=z.value)&&(C[F.key]=F);x=g.f(Y);for(k=x.next();!k.done;k=x.next())(ZU=k.value)&&(p[ZU.key]=ZU);CW=g.f(O);for(nW=CW.next();!nW.done;nW=CW.next())sC=nW.value,e5=
void 0,H[(e5=sC.videoItem)!=null?e5:""]=!0,sC.videoItem&&(dd=LW=void 0,M=(dd=(LW=g.DP(sC.videoItem))==null?void 0:LW.entityId)!=null?dd:"",u.push({externalVideoId:M}));U=t.filter(function(v){if(!v||!v.key||!v.offlineVideoPolicy)return!1;v=g.DP(v.key).entityId;v=g.YU(v,"downloadStatusEntity");var OC;return!(v&&((OC=C[v])==null?void 0:OC.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
r=U.map(function(v){var OC=T[v.transfer],S5=[];if(OC==null?0:OC.offlineVideoStreams)for(var N5=g.f(OC.offlineVideoStreams),Q=N5.next();!Q.done;Q=N5.next())(Q=p[Q.value])&&S5.push(Q);N5=K[v.offlineVideoPolicy];Q=H;var lj=v==null?void 0:v.playerResponseTimestamp,dR=g.DP(N5.key).entityId;v=g.YU(dR,"mainVideoEntity");if(N5.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var bj="OFFLINE_VIDEO_STATE_DISABLED";N5.expirationTimestamp&&Number(N5.expirationTimestamp)<Date.now()/1E3&&(bj="OFFLINE_VIDEO_STATE_EXPIRED")}else if(N5.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")bj="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(OC==null?void 0:OC.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":bj="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":bj="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":bj="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":bj="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":bj="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":bj="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:bj="OFFLINE_VIDEO_STATE_UNKNOWN"}if(bj==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(OC==null?void 0:OC.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":bj="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":bj="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":bj=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}dR={id:dR,videoState:bj};if(OC==null?0:OC.cotn)dR.cotn=OC.cotn;if(OC==null?0:OC.maximumDownloadQuality)dR.selectedVideoQuality=OC==null?void 0:OC.maximumDownloadQuality;if(OC==null?0:OC.lastProgressTimeMs)dR.lastProgressTimeMs=OC.lastProgressTimeMs;lj&&(dR.playerResponseSavedTimeMs=String(Number(lj)*1E3));OC=String;lj=0;S5=g.f(S5);for(bj=S5.next();!bj.done;bj=S5.next())if(bj=bj.value,bj.streamsProgress){bj=g.f(bj.streamsProgress);for(var aa=bj.next();!aa.done;aa=
bj.next()){var YV=void 0;lj+=Number((YV=aa.value.numBytesDownloaded)!=null?YV:0)}}dR.downloadedBytes=OC(lj);dR.selectedOfflineMode=Q[v]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";N5.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(dR.offlinePlaybackDisabledReason=N5.offlinePlaybackDisabledReason);return dR});
return y.return({offlineVideos:r,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:u}}})})},taL=function(){this.locks=navigator.locks},lm6=function(){try{var A=g.Vk("ytglobal.locks_");
if(A)return A;var n;if(n=navigator){var O=navigator;n="locks"in O&&!!O.locks}if(n)return g.vj.localStorage&&g.vj.localStorage.getItem("noop"),A=new taL,g.Bj("ytglobal.locks_",A),A}catch(L){}},Z1=function(){},DjV=function(){},YbV=function(A){if(A.includes(":"))throw Error("Invalid user cache name: "+A);
return A+":"+g.L4("CacheStorage get")},mjW=function(){return g.P(function(A){if(AS!==void 0)return A.return(AS);
AS=new Promise(function(n){var O;return g.P(function(L){switch(L.U){case 1:return g.EC(L,2),g.a(L,ns.open("test-only"),4);case 4:return g.a(L,ns.delete("test-only"),5);case 5:g.ij(L,3);break;case 2:if(O=g.M5(L),O instanceof Error&&O.name==="SecurityError")return n(!1),L.return();case 3:n("caches"in window),g.Kx(L)}})});
return A.return(AS)})},djd=function(){return g.P(function(A){if(A.U==1)return g.a(A,mjW(),2);
if(!A.J)return A.return(void 0);T06||(T06=new DjV);return A.return(T06)})},Oz=function(A,n,O){g.R5(new g.OU("Woffle: "+A,O?{cotn:O}:""));
n instanceof Error&&g.R5(n)},xjw=function(A){var n;
return g.P(function(O){if(O.U==1)return g.a(O,bnV(A),2);n=O.J;g.f4("offlineStateSnapshot",n);g.Kx(O)})},Ls=function(A){g.V.call(this);
var n=this;this.api=A;this.uo={hpa:function(){return n.U},
DU5:function(){return n.J}};
typeof g.vj.BroadcastChannel!=="undefined"&&(this.U=new g.vj.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.L4()),this.U.onmessage=this.C.bind(this),this.J=new g.vj.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.L4()),this.J.onmessage=this.L.bind(this))},JS=function(A,n){A.api.sN("onOfflineOperationFailure",n);
var O;(O=A.U)==null||O.postMessage(n)},fmN=function(A,n,O,L){var J=this;
this.G=A;this.X=n;this.visibility=O;this.D=L;this.B=this.W=this.Z=this.C=this.U=!1;this.L=new g.cy(function(){J.Qa()});
this.uo={Hh:function(){return J.J},
Qa:function(){J.Qa()},
IPH:function(){return J.L}};
this.visibility.subscribe("visibilitystatechange",function(){J.QN()})},KDr=function(A){if(!A.C&&!A.U){var n=lm6();
if(n){A.C=!0;var O=g.L4("OfflineLockManager");n.request("woffle_orchestration_leader:"+O,{},function(){var L,J,S,N;return g.P(function(G){switch(G.U){case 1:return g.EC(G,2),A.J=new g.i6,A.U=!0,A.C=!1,g.a(G,A.G(),4);case 4:return g.a(G,A.J.promise,5);case 5:g.ij(G,0);break;case 2:L=g.M5(G),((S=(J=A).D)==null?0:S.call(J,"wo_relinquish_leadership_on_lock_request_error"))||A.Qa(),L instanceof Error&&(N=L,N.args=[{name:"WoLockManagerError",AO:L.name}],g.Vd(N)),g.Kx(G)}})})}}},ElD=function(A){A.U&&(A.B=
!0,Sq(A))},CRD=function(A,n){A.U&&(A.Z=n,Sq(A))},inp=function(A,n){A.U&&(A.W=n,Sq(A))},Sq=function(A){A.W&&A.Z&&A.B&&A.visibility.isBackground()?g.GU(A.L,6E4):A.L.stop()},Nd=function(A){var n;
A.offlineDeleteReason=(n=A.offlineDeleteReason)!=null?n:"OFFLINE_DELETE_REASON_UNKNOWN";var O;A.offlineModeType=(O=A.offlineModeType)!=null?O:"OFFLINE_NOW";g.f4("offlineDeleteEvent",A)},cf=function(A,n){var O=n.videoId;
var L=n.Ow;n=n.offlineModeType;A.encryptedVideoId=O;A.cotn=L==null?void 0:L.cotn;A.offlineabilityFormatType=L==null?void 0:L.maximumDownloadQuality;var J;A.isRefresh=(J=L==null?void 0:L.isRefresh)!=null?J:!1;var S;A.softErrorCount=(S=L==null?void 0:L.transferRetryCount)!=null?S:0;A.offlineModeType=n!=null?n:"OFFLINE_NOW";(A.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&A.statusType==="UNKNOWN_STATUS_TYPE"||!A.transferStatusType&&!A.statusType)&&g.R5(Error("Woffle unknown transfer status"));
g.f4("offlineTransferStatusChanged",A)},p0h=function(A,n,O,L){L={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!L};n&&O&&(n=Math.floor(n/1024).toFixed(),O=Math.floor(O/1024).toFixed(),L.alreadyDownloadedKbytes=n,L.totalFetchedKbytes=n,L.totalContentKbytes=O);cf(L,A)},Ujp=function(A){cf({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},A)},Hnd=function(A){switch(A){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Gv=function(A){var n,O,L;
return((L=(n=A.actionMetadata)==null?void 0:(O=n.retryScheduleIntervalsInSeconds)==null?void 0:O.length)!=null?L:0)>0},be=function(A){return A.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!A.entityKey},tS=function(A){return A.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!A.entityKey},le=function(A){return A.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!A.entityKey},s$V=function(A){return A.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!A.entityKey},
DD=function(A,n,O,L,J){J=J===void 0?!1:J;
var S,N,G,b,t,l;return g.P(function(D){if(D.U==1)return S=g.YU(A,n),N=g.YU(A,"downloadStatusEntity"),g.a(D,wT(O,{mode:"readonly",iA:!0},function(Y){return g.uO.all([VT(Y,S,n),VT(Y,N,"downloadStatusEntity")])}),2);
G=D.J;b=G.length?G[0]:void 0;if(!b)return D.TV(0);t=glc;if(l=G.length>1?G[1]:void 0){if(l.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!J)return D.return();l.downloadState=L}else l={key:N,downloadState:L};g.kN(b,t,l);return g.a(D,wT(O,{mode:"readwrite",iA:!0},function(Y){return g.uO.all([zz(Y,b,n),zz(Y,l,"downloadStatusEntity")])}),0)})},Y7=function(A,n){return A.actionType===n.actionType&&A.entityKey===n.entityKey},mZ=function(A,n){if(A&&A.transferState!=="TRANSFER_STATE_COMPLETE"&&A.transferState!==
"TRANSFER_STATE_FAILED"){var O=g.DP(A.key).entityId;
cf({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:O,Ow:A,offlineModeType:n})}},Tv=function(A){if(!A||!A.thumbnails)return[];
var n=[];A=g.f(A.thumbnails);for(var O=A.next();!O.done;O=A.next())O=O.value,O.url&&n.push(O.url);return n},j$N=function(A,n,O){O=O===void 0?[]:O;
var L,J,S,N,G,b,t,l,D,Y,m,T,K;return g.P(function(C){if(C.U==1)return O.length?g.a(C,FK(A,n),2):C.return([]);L=C.J;J=new Set;S=g.f(L);for(N=S.next();!N.done;N=S.next())if(G=N.value,b=G.id||G.key)t=g.DP(b).entityId,J.add(t);l=[];D=g.f(O);for(Y=D.next();!Y.done;Y=D.next())m=Y.value,T=m.offlineVideoData,K=void 0,((K=T)==null?0:K.videoId)&&!J.has(T.videoId)&&l.push(m);return C.return(l)})},rKd=function(A,n,O){return new g.RT(A,{cotn:n,
raw_player_response:O,download_media:!0,start:Infinity,disable_watch_next:!0})},amd=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},da=function(A,n,O,L,J,S,N,G,b,t,l){this.entityType=A;
this.actionId=n;this.action=O;this.parentActionId=L;this.rootActionId=J===void 0?n:J;this.childActionIds=S;this.prereqActionId=N;this.postreqActionIds=G;this.hasChildActionFailed=t;this.retryScheduleIndex=0;this.U=l||Date.now();this.retryScheduleIndex=b||0},x7=function(A){if(!A.key)throw Error("Entity key is required.");
if(!A.actionProto)throw Error("OfflineOrchestrationAction is required.");var n=g.DP(A.key),O=g.DP(A.actionProto.entityKey);return new da(O.entityType,n.entityId,A.actionProto,A.parentActionId,A.rootActionId,A.childActionIds,A.prereqActionId,A.postreqActionIds,A.retryScheduleIndex,A.hasChildActionFailed,Number(A.enqueueTimeSec)*1E3)},fs=function(A){return{key:g.YU(A.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:A.action,parentActionId:A.parentActionId,rootActionId:A.rootActionId,childActionIds:A.childActionIds,prereqActionId:A.prereqActionId,postreqActionIds:A.postreqActionIds,retryScheduleIndex:A.retryScheduleIndex,hasChildActionFailed:A.hasChildActionFailed,enqueueTimeSec:(A.U/1E3).toFixed()}},uC3=function(){var A;
return g.P(function(n){return n.U==1?g.a(n,djd(),2):(A=n.J)?n.return(A.delete("yt-player-local-img")):n.return(!0)})},Ks=function(A){var n,O;
return g.P(function(L){if(L.U==1)return g.a(L,djd(),2);if(L.U!=3){n=L.J;if(!n)throw Error("Cache API not supported");return A.length?g.a(L,n.open("yt-player-local-img"),3):L.return()}O=L.J;return g.a(L,Promise.all(A.map(function(J){return O.delete(J)})),0)})},Ez=function(A){var n,O;
return g.P(function(L){if(L.U==1)return g.a(L,djd(),2);if(L.U!=3){n=L.J;if(!n)throw Error("Cache API not supported");return A.length?g.a(L,n.open("yt-player-local-img"),3):L.return()}O=L.J;return g.a(L,O.addAll(A),0)})},Cs=function(A,n,O,L,J){var S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I,B,q,W,Ju,cj,Au,z,F,x,k,ZU,CW,nW,sC,e5;
return g.P(function(LW){switch(LW.U){case 1:return S=g.YU(A,"mainVideoEntity"),N=g.YU(A,"ytMainChannelEntity"),G=g.YU(A,"transfer"),b=g.YU(A,"videoDownloadContextEntity"),g.a(LW,wT(n,{mode:"readonly",iA:!0},function(dd){return g.uO.all([VT(dd,S,"mainVideoEntity"),VT(dd,N,"ytMainChannelEntity"),VT(dd,G,"transfer"),VT(dd,b,"videoDownloadContextEntity"),Re(dd,"ytMainChannelEntity"),Re(dd,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:t=LW.J;l=g.f(t);D=l.next().value;Y=l.next().value;m=l.next().value;T=l.next().value;K=l.next().value;C=l.next().value;p=D;H=Y;u=m;I=T;B=K;q=C;if(!p&&!H){LW.TV(3);break}W=p?Tv(p.thumbnail):[];if(!H){Ju=[];LW.TV(4);break}return g.a(LW,PRh(H,B),5);case 5:Ju=LW.J;case 4:return cj=Ju,g.a(LW,Ks(W.concat(cj)),3);case 3:Au=[];z=g.YU(A,"downloadStatusEntity");F=g.f(q);for(x=F.next();!x.done;x=F.next())k=x.value,ZU=g.DP(k.key).entityId,CW=x7(k),nW=g.DP(CW.action.entityKey).entityId,ZU!==A&&nW!==A||Y7(O,
k.actionProto)||Au.push(k.key);return g.a(LW,wT(n,{mode:"readwrite",iA:!0},function(dd){var M=Au.map(function(U){return oe(dd,U)});
M.push(oe(dd,S,{kJ:!0}));M.push(oe(dd,z,{kJ:!0}));return g.uO.all(M)}),7);
case 7:e5=(sC=I)==null?void 0:sC.offlineModeType,J&&(Nd(J),J.offlineModeType&&(e5=J.offlineModeType)),mZ(u,e5),JS(L,{entityKey:S,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Kx(LW)}})},Q$V=function(A,n,O,L){var J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I,B,q,W,Ju,cj,Au,z,F,x,k,ZU,CW,nW,sC,e5,LW,dd,M,U,r,y,v,OC,S5,N5,Q,lj,dR,bj,aa,YV,RL,YW;
return g.P(function(oa){switch(oa.U){case 1:return J=g.YU(A,"mainPlaylistEntity"),S=g.YU(A,"ytMainChannelEntity"),g.a(oa,wT(n,{mode:"readonly",iA:!0},function(vx){return g.uO.all([VT(vx,J,"mainPlaylistEntity"),VT(vx,S,"ytMainChannelEntity"),Re(vx,"mainPlaylistEntity"),Re(vx,"mainDownloadsListEntity"),Re(vx,"ytMainChannelEntity"),Re(vx,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:N=oa.J;G=g.f(N);b=G.next().value;t=G.next().value;l=G.next().value;D=G.next().value;Y=G.next().value;m=G.next().value;T=b;K=t;C=l;p=D;H=Y;u=m;if(!T&&!K){oa.TV(3);break}I=T?yKL(T):[];if(!K){B=[];oa.TV(4);break}return g.a(oa,PRh(K,H),5);case 5:B=oa.J;case 4:return q=B,g.a(oa,Ks(I.concat(q)),3);case 3:W=[];Ju=new Map;if(!T){oa.TV(7);break}return g.a(oa,ImX(T,C,p),8);case 8:W=oa.J;cj=g.f(W);for(Au=cj.next();!Au.done;Au=cj.next())z=Au.value,Ju.set(z,{videoId:z,playlistId:A,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.a(oa,wT(n,{mode:"readonly",iA:!0},function(vx){return g.uO.all([Re(vx,"transfer"),Re(vx,"videoDownloadContextEntity")])}),9);
case 9:F=oa.J;x=g.f(F);k=x.next().value;ZU=x.next().value;CW=k;nW=ZU;sC=g.f(CW);for(e5=sC.next();!e5.done;e5=sC.next())LW=e5.value,dd=g.DP(LW.key).entityId,(M=Ju.get(dd))&&LW&&(M.cotn=LW.cotn);U=g.f(nW);for(r=U.next();!r.done;r=U.next())y=r.value,v=g.DP(y.key).entityId,(OC=Ju.get(v))&&y&&(OC.offlineModeType=y.offlineModeType);case 7:S5=[];N5=g.f(u);for(Q=N5.next();!Q.done;Q=N5.next())lj=Q.value,dR=g.DP(lj.key).entityId,bj=x7(lj),dR!==A&&bj.rootActionId!==A||Y7(O,lj.actionProto)||S5.push(lj.key);aa=
g.YU(A,"mainPlaylistEntity");return g.a(oa,wT(n,{mode:"readwrite",iA:!0},function(vx){var b3=S5.map(function(aC){return oe(vx,aC)});
b3.push(oe(vx,aa,{kJ:!0}));return g.uO.all(b3)}),10);
case 10:if(!T){oa.TV(0);break}W.reverse();if(!W){oa.TV(0);break}YV=g.f(W);RL=YV.next();case 13:if(RL.done){oa.TV(0);break}YW=RL.value;return g.a(oa,Cs(YW,n,O,L,Ju.get(YW)),14);case 14:RL=YV.next(),oa.TV(13)}})},vld=function(A,n,O,L){var J,S,N,G,b,t,l,D,Y;
return g.P(function(m){if(m.U==1)return J=g.YU("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),S=new Map,g.a(m,wT(A,{mode:"readwrite",iA:!0},function(T){var K=Re(T,"transfer"),C=Re(T,"offlineOrchestrationActionWrapperEntity"),p=Re(T,"videoDownloadContextEntity"),H=VT(T,J,"mainDownloadsListEntity");return g.uO.all([K,C,p,H]).then(function(u){u=g.f(u);var I=u.next().value;var B=u.next().value;var q=u.next().value;var W=u.next().value;u=$jK.map(function(cj){return Pqc(T,cj)});
B=g.f(B);for(var Ju=B.next();!Ju.done;Ju=B.next())Ju=Ju.value,Y7(n,Ju.actionProto)||u.push(oe(T,Ju.key,{kJ:!0}));W&&(W.downloads=[],u.push(zz(T,W,"mainDownloadsListEntity")));if(q)for(q=g.f(q),W=q.next();!W.done;W=q.next())W=W.value,B=g.DP(W.key).entityId,B=g.YU(B,"transfer"),S.set(B,W.offlineModeType);return g.uO.all(u).then(function(){return I})})}),2);
N=m.J;G=g.f(N);for(b=G.next();!b.done;b=G.next())t=b.value,mZ(t,S.get(t.key)),l=g.DP(t.key).entityId,D={videoId:l,offlineDeleteReason:L,cotn:t.cotn,offlineModeType:S.get(t.key)},Nd(D),Y=g.YU(l,"mainVideoEntity"),JS(O,{entityKey:Y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.a(m,uC3(),0)})},yKL=function(A,n){var O=[];
if(A.thumbnailStyleData){A=g.f(A.thumbnailStyleData);for(var L=A.next();!L.done;L=A.next()){var J=void 0,S=void 0,N=void 0;O=O.concat(Tv((J=L.value)==null?void 0:(S=J.value)==null?void 0:(N=S.collageThumbnail)==null?void 0:N.coverThumbnail))}}n=Tv(n);return O.concat(n)},ImX=function(A,n,O){var L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I,B,q,W,Ju,cj;
return g.P(function(Au){L=[];J=new Set;if(O.length)for(S=g.f(O),N=S.next();!N.done;N=S.next())if(G=N.value,b=void 0,(b=G.downloads)==null?0:b.length)for(t=g.f(G.downloads),l=t.next();!l.done;l=t.next())D=l.value,D.videoItem&&(Y=g.DP(D.videoItem).entityId,J.add(Y));if(A.videos){m=g.f(A.videos);for(T=m.next();!T.done;T=m.next())K=T.value,C=JSON.parse(g.DP(K).entityId),C.videoId&&!J.has(C.videoId)&&L.push(C.videoId);p=g.f(n);for(H=p.next();!H.done;H=p.next())if(u=H.value,u.key!==A.key&&(I=u.videos))for(B=
g.f(I),q=B.next();!q.done;q=B.next())W=q.value,Ju=JSON.parse(g.DP(W).entityId),Ju.videoId&&(cj=L.indexOf(Ju.videoId),cj!==-1&&L.splice(cj,1))}return Au.return(L)})},PRh=function(A,n){var O,L,J,S,N,G,b,t;
return g.P(function(l){O=Tv(A.avatar);L=g.f(n);for(J=L.next();!J.done;J=L.next())if(S=J.value,S.id!==A.id)for(N=g.f(Tv(S.avatar)),G=N.next();!G.done;G=N.next())b=G.value,t=O.indexOf(b),t!==-1&&O.splice(t,1);return l.return(O)})},B0w=function(A){var n;
return g.P(function(O){n=g.h(A.frameworkUpdates,ie);return A.frameworkUpdates&&n?g.a(O,kkp(n),0):O.return()})},RTc=function(A){var n;
if((n=A.onResponseReceivedActions)!=null&&n.length){var O;A=(O=g.h(g.h(A.onResponseReceivedActions[0],VaN),g.Jdh))==null?void 0:O.actions;if(A!=null&&A.length)return A}},hT3=function(A){var n,O,L;
return g.P(function(J){if(J.U==1)return A?g.a(J,e2(A,g.uW,"mainDownloadsListEntity"),2):J.return([]);n=J.J;return((O=n)==null?0:(L=O.downloads)==null?0:L.length)?J.return(n.downloads.map(function(S){var N;return(N=S.videoItem)!=null?N:""})):J.return([])})},olp=function(A,n){var O;
return g.P(function(L){return L.U==1?g.a(L,zTw(A,n),2):(O=L.J)?g.a(L,wT(A,{mode:"readwrite",iA:!0},function(J){var S=[zz(J,O.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];O.mainDownloadsListEntity&&S.push(zz(J,O.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.uO.all(S)}),0):L.TV(0)})},zTw=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u;
return g.P(function(I){if(I.U==1)return O=g.YU("main_downloads_library_id","mainDownloadsLibraryEntity"),L=g.YU("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.a(I,wT(A,{mode:"readonly",iA:!0},function(B){return g.uO.all([VT(B,O,"mainDownloadsLibraryEntity"),VT(B,L,"mainDownloadsListEntity")])}),2);
J=I.J;S=g.f(J);N=S.next().value;G=S.next().value;b=N;t=G;b||(b={id:O});l=g.f(n);for(D=l.next();!D.done;D=l.next())if(Y=D.value,Y===g.uW){if(b.smartDownloadsList)return I.return();b.smartDownloadsList=Y}else if(m=g.DP(Y).entityType,T={},m==="mainPlaylistEntity"?T.playlistItem=Y:m==="mainVideoEntity"&&(T.videoItem=Y),!g.aW(T)){K=void 0;if((K=t)==null?0:K.downloads){C=!1;p=g.f(t.downloads);for(H=p.next();!H.done;H=p.next())if(u=H.value,u.playlistItem===Y||u.videoItem===Y){C=!0;break}C||t.downloads.push(T)}else t=
{id:L,downloads:[T]};b.downloadsList=L}return I.return({mainDownloadsLibraryEntity:b,mainDownloadsListEntity:t})})},qbL=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C;
return g.P(function(p){if(p.U==1)return O=g.YU("main_downloads_library_id","mainDownloadsLibraryEntity"),L=g.YU("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.a(p,wT(A,{mode:"readonly",iA:!0},function(H){return g.uO.all([VT(H,O,"mainDownloadsLibraryEntity"),VT(H,L,"mainDownloadsListEntity"),VT(H,g.uW,"mainDownloadsListEntity")])}),2);
J=p.J;S=g.f(J);N=S.next().value;G=S.next().value;b=S.next().value;t=N;l=G;D=b;if(!t)return p.TV(0);if(n===g.uW&&((Y=D)==null?0:Y.downloads))D.downloads=[];else if((m=l)==null?0:m.downloads)for(T=g.DP(n).entityType,K=0;K<l.downloads.length;K++)if(C=l.downloads[K],T==="mainVideoEntity"&&C.videoItem===n){l.downloads.splice(K,1);break}else if(T==="mainPlaylistEntity"&&C.playlistItem===n){l.downloads.splice(K,1);break}return g.a(p,wT(A,{mode:"readwrite",iA:!0},function(H){var u=[zz(H,t,"mainDownloadsLibraryEntity")];
l&&u.push(zz(H,l,"mainDownloadsListEntity"));D&&u.push(zz(H,D,"mainDownloadsListEntity"));return g.uO.all(u)}),0)})},Md=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y;
return g.P(function(m){if(m.U==1)return O=g.YU(n,"transfer"),L=g.YU(n,"videoDownloadContextEntity"),g.a(m,wT(A,{mode:"readonly",iA:!0},function(T){return g.uO.all([VT(T,O,"transfer"),VT(T,L,"videoDownloadContextEntity")])}),2);
J=m.J;S=g.f(J);N=S.next().value;G=S.next().value;b=N;t=G;Y={videoId:n,cotn:(l=b)==null?void 0:l.cotn,offlineModeType:(D=t)==null?void 0:D.offlineModeType};return m.return(Y)})},ps=function(A,n,O,L,J){var S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I,B,q,W,Ju;
return g.P(function(cj){switch(cj.U){case 1:return S=g.YU(A,"musicTrack"),N=g.YU(A,"transfer"),g.a(cj,wT(n,{mode:"readonly",iA:!0},function(Au){return g.uO.all([VT(Au,S,"musicTrack"),VT(Au,N,"transfer"),Re(Au,"musicTrack"),Re(Au,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:G=cj.J;b=g.f(G);t=b.next().value;l=b.next().value;D=b.next().value;Y=b.next().value;m=t;T=l;K=D;C=Y;if(!m){cj.TV(3);break}return g.a(cj,kip(m,K),4);case 4:return p=cj.J,g.a(cj,Ks(p),3);case 3:H=[];u=g.f(C);for(I=u.next();!I.done;I=u.next())B=I.value,q=g.DP(B.key).entityId,W=x7(B),Ju=g.DP(W.action.entityKey).entityId,q!==A&&Ju!==A||Y7(O,B.actionProto)||H.push(B.key);return g.a(cj,wT(n,{mode:"readwrite",iA:!0},function(Au){var z=H.map(function(F){return oe(Au,F)});
z.push(oe(Au,S,{kJ:!0}));return g.uO.all(z)}),6);
case 6:mZ(T),J&&Nd(J),JS(L,{entityKey:S,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Kx(cj)}})},Uz=function(A,n,O,L,J){var S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I,B,q,W,Ju,cj,Au,z,F,x,k,ZU,CW,nW,sC,e5,LW,dd,M,U,r;
return g.P(function(y){switch(y.U){case 1:return S=g.YU(A,n),N=g.YU("music_downloads_library_id","musicDownloadsLibraryEntity"),g.a(y,wT(O,{mode:"readonly",iA:!0},function(v){return g.uO.all([VT(v,S,n),VT(v,N,"musicDownloadsLibraryEntity"),Re(v,n),Re(v,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:G=y.J;b=g.f(G);t=b.next().value;l=b.next().value;D=b.next().value;Y=b.next().value;m=t;T=l;K=D;C=Y;if(!m){y.TV(3);break}return g.a(y,kip(m,K),4);case 4:return p=y.J,g.a(y,Ks(p),3);case 3:H=[];u=new Map;if(!m){y.TV(6);break}return g.a(y,w0h(m,K,T),7);case 7:H=y.J;I=g.f(H);for(B=I.next();!B.done;B=I.next())q=B.value,W=g.DP(q).entityId,u.set(W,{videoId:W,playlistId:A,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.a(y,FK(O,"transfer"),8);case 8:for(Ju=y.J,cj=g.f(Ju),
Au=cj.next();!Au.done;Au=cj.next())z=Au.value,F=g.DP(z.key).entityId,(x=u.get(F))&&z&&(x.cotn=z.cotn);case 6:k=[];ZU=g.f(C);for(CW=ZU.next();!CW.done;CW=ZU.next())nW=CW.value,sC=g.DP(nW.key).entityId,e5=x7(nW),sC!==A&&e5.rootActionId!==A||Y7(L,nW.actionProto)||k.push(nW.key);LW=g.YU(A,n);return g.a(y,wT(O,{mode:"readwrite",iA:!0},function(v){var OC=k.map(function(S5){return oe(v,S5)});
OC.push(oe(v,LW,{kJ:!0}));return g.uO.all(OC)}),9);
case 9:if(!m){y.TV(0);break}H.reverse();if(!H.length){y.TV(0);break}dd=g.f(H);M=dd.next();case 12:if(M.done){y.TV(0);break}U=M.value;r=g.DP(U).entityId;if(!r){y.TV(13);break}return g.a(y,ps(r,O,L,J,u.get(r)),13);case 13:M=dd.next(),y.TV(12)}})},Hf=function(A,n,O){var L,J,S,N,G,b,t;
return g.P(function(l){if(l.U==1)return g.a(l,wT(A,{mode:"readwrite",iA:!0},function(D){var Y=Re(D,"transfer"),m=Re(D,"offlineOrchestrationActionWrapperEntity");return g.uO.all([Y,m]).then(function(T){T=g.f(T);var K=T.next().value;var C=T.next().value;T=WDL.map(function(I){return Pqc(D,I)});
C=g.f(C);for(var p=C.next();!p.done;p=C.next()){p=p.value;var H=g.DP(p.actionProto.entityKey).entityType==="musicTrack",u=p.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";Y7(n,p.actionProto)||H&&(!H||u)||T.push(oe(D,p.key,{kJ:!0}))}return g.uO.all(T).then(function(){return K})})}),2);
L=l.J;J=g.f(L);for(S=J.next();!S.done;S=J.next())N=S.value,mZ(N),G=g.DP(N.key).entityId,b={videoId:G,offlineDeleteReason:void 0,cotn:N.cotn},Nd(b),t=g.YU(G,"musicTrack"),JS(O,{entityKey:t,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.a(l,uC3(),0)})},eTc=function(A){for(var n,O=g.f(A.additionalMetadatas),L=O.next();!L.done;L=O.next())L=L.value,L.offlineMusicVideoData&&(n=L.offlineMusicVideoData);
var J,S,N,G,b;return{id:g.YU(A.videoId,"musicTrack"),videoId:A.videoId,title:A.title,thumbnailDetails:A.thumbnail,lengthMs:String(Number(A.lengthSeconds)*1E3),albumTitle:(J=n)==null?void 0:J.releaseTitle,musicVideoType:(S=n)==null?void 0:S.musicVideoType,contentRating:{explicitType:(N=n)==null?void 0:N.explicitType},artistNames:((G=n)==null?void 0:G.byline)||((b=n)==null?void 0:b.channelName),downloadMetadata:g.YU(A.videoId,"musicTrackDownloadMetadataEntity")}},w0h=function(A,n,O){var L,J,S,N,G,b,
t,l,D,Y,m,T,K,C,p,H,u,I;
return g.P(function(B){L=[];J=new Set;if((S=O)==null?0:(N=S.downloadedTracks)==null?0:N.length)for(G=g.f(O.downloadedTracks),b=G.next();!b.done;b=G.next())t=b.value,J.add(t);if(A.tracks){l=g.f(A.tracks);for(D=l.next();!D.done;D=l.next())Y=D.value,J.has(Y)||L.push(Y);m=g.f(n);for(T=m.next();!T.done;T=m.next())if(K=T.value,K.id!==A.id&&(C=K.tracks))for(p=g.f(C),H=p.next();!H.done;H=p.next())u=H.value,I=L.indexOf(u),I!==-1&&L.splice(I,1)}return B.return(L)})},kip=function(A,n){var O,L,J,S,N,G,b,t;
return g.P(function(l){O=Tv(A.thumbnailDetails);L=g.f(n);for(J=L.next();!J.done;J=L.next())if(S=J.value,S.id!==A.id)for(N=g.f(Tv(S.thumbnailDetails)),G=N.next();!G.done;G=N.next())b=G.value,t=O.indexOf(b),t!==-1&&O.splice(t,1);return l.return(O)})},FDh=function(A,n){var O,L,J,S,N,G,b,t,l;
return g.P(function(D){if(D.U==1)return O=g.YU("music_downloads_library_id","musicDownloadsLibraryEntity"),g.a(D,e2(A,O,"musicDownloadsLibraryEntity"),2);(L=D.J)||(L={id:O});J=g.DP(n).entityType;J==="musicTrack"?(S=L.downloadedTracks)!=null&&S.includes(n)||(L.downloadedTracks=((N=L.downloadedTracks)!=null?N:[]).concat(n)):J==="musicPlaylist"?(G=L.downloadedPlaylists)!=null&&G.includes(n)||(L.downloadedPlaylists=((b=L.downloadedPlaylists)!=null?b:[]).concat(n)):J!=="musicAlbumRelease"||(t=L.downloadedAlbumReleases)!=
null&&t.includes(n)||(L.downloadedAlbumReleases=((l=L.downloadedAlbumReleases)!=null?l:[]).concat(n));return g.a(D,Wa(A,L,"musicDownloadsLibraryEntity"),0)})},X0W=function(A,n){var O,L,J,S,N,G,b;
return g.P(function(t){if(t.U==1)return O=g.YU("music_downloads_library_id","musicDownloadsLibraryEntity"),g.a(t,e2(A,O,"musicDownloadsLibraryEntity"),2);L=t.J;if(!L)return t.TV(0);J=g.DP(n).entityType;J==="musicTrack"?S=L.downloadedTracks:J==="musicPlaylist"&&(S=L.downloadedPlaylists);if((N=S)==null?0:N.length)for(G=0;G<S.length;G++)if(b=S[G],b===n){S.splice(G,1);break}return g.a(t,Wa(A,L,"musicDownloadsLibraryEntity"),0)})},ZnX=function(A){var n=A.videos;
A=[];var O=[];if(n){n=g.f(n);for(var L=n.next();!L.done;L=n.next()){var J=L.value.offlineVideoData.videoId;L=g.YU(J,"musicTrack");J=g.YU(J,"musicTrackDownloadMetadataEntity");A.push(L);O.push(J)}}return{rl:A,e5:O}},sz=function(A,n,O){n={track:eTc(n)};
O&&(n.playlistId=O);if(A=g.h(A.actionMetadata,ATK))n.maximumDownloadQuality=A.maximumDownloadQuality;return{musicTrackEntityActionMetadata:n}},O8R=function(A){var n,O,L,J,S,N,G,b;
return g.P(function(t){switch(t.U){case 1:return n=g.la(),O=nlr(A),L=g.x2(nQp),g.EC(t,2),S={cM:!0},g.a(t,g.AF(n,O,L,void 0,S),4);case 4:J=t.J;g.ij(t,3);break;case 2:N=g.M5(t);if(N instanceof g.GC)throw G="GetOffline network manager error: "+N.message,Oz(G,N),Error(G);Oz("GetOffline fetch request error",N);throw Error("GetOffline fetch request error");case 3:b=jq(J);if(!J)throw Oz("Network request failed"),Error("Network request failed");if(b!==void 0)ra(b);else if(!J.videos||!J.videos.length)throw Oz("No data"),
Error("No data");return t.return(J.videos.map(function(l){return l.offlineVideoData}))}})},L6R=function(A){var n,O,L,J,S,N,G,b;
return g.P(function(t){switch(t.U){case 1:return n=g.la(),O=OnW(A),L=g.x2(nQp),g.EC(t,2),S={cM:!0},g.a(t,g.AF(n,O,L,void 0,S),4);case 4:J=t.J;g.ij(t,3);break;case 2:N=g.M5(t);if(N instanceof g.GC)throw G="GetOffline network manager error for playlist: "+N.message,Oz(G,N),Error(G);Oz("GetOffline fetch request error for playlist",N);throw Error("GetOffline fetch request error for playlist");case 3:b=jq(J);if(!J)throw Oz("Network request failed for playlist"),Error("Network request failed for playlist");
if(b!==void 0)ra(b,"playlist");else if(!J.playlists||!J.playlists.length)throw Oz("No data for playlist"),Error("No data for playlist");return t.return(J.playlists.map(function(l){return l.offlinePlaylistData}))}})},S8X=function(A,n,O,L){var J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I,B,q,W,Ju,cj,Au,z,F,x,k,ZU,CW,nW;
return g.P(function(sC){switch(sC.U){case 1:return g.a(sC,XK(),2);case 2:J=sC.J;if(!J)return sC.return([]);S=[];if((N=L)==null?0:N.length){S=L;sC.TV(3);break}return g.a(sC,FK(J,"mainPlaylistEntity"),4);case 4:S=sC.J;case 3:if(!S.length)return sC.return([]);G=[];b=Date.now()/1E3;t=g.f(S);l=t.next();case 5:if(l.done)return G.length?g.a(sC,JTN(G),10):sC.return([]);D=l.value;if(!D.downloadState){Y=void 0;sC.TV(8);break}return g.a(sC,e2(J,D.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:Y=
sC.J;case 8:m=Y;T=void 0;C=(K=(T=D)==null?void 0:T.entityMetadata)&&K.nextAutoRefreshIntervalSeconds?Number(K.nextAutoRefreshIntervalSeconds):NaN;p=Number.isNaN(C)?A:C;u=H=void 0;I=((H=m)==null?0:H.lastSyncedTimestampMillis)?Number((u=m)==null?void 0:u.lastSyncedTimestampMillis)/1E3:0;q=B=void 0;W=((B=m)==null?0:B.addedTimestampMillis)?Number((q=m)==null?void 0:q.addedTimestampMillis)/1E3:0;if(O||!K||I+p<=b){Ju=[];cj=void 0;if((cj=D.videos)==null?0:cj.length)for(Au=g.f(D.videos),z=Au.next();!z.done;z=
Au.next())F=z.value,x=JSON.parse(g.DP(F).entityId),x.videoId&&Ju.push(x.videoId);k="0";K&&(ZU=void 0,k=String(Number((ZU=K.offlineLastModifiedTimestampSeconds)!=null?ZU:0).toFixed()));CW={playlistId:D.playlistId,videoIds:Ju,offlineLastModifiedTimestamp:k,autoSync:n,offlineDateAddedTimestamp:String(W.toFixed())};G.push(CW)}l=t.next();sC.TV(5);break;case 10:return nW=sC.J,sC.return(nW)}})},NKN=function(){var A,n,O,L,J;
return g.P(function(S){if(S.U==1)return g.a(S,XK(),2);if(S.U!=3)return(A=S.J)?g.a(S,FK(A,"refresh"),3):S.return(!1);n=S.J;if((O=n[0])==null||!O.refreshTime)return S.return(!1);L=Number(n[0].refreshTime);J=Date.now()/1E3;return S.return(isFinite(L)&&J>=L)})},GcL=function(A,n){var O,L,J;
return g.P(function(S){switch(S.U){case 1:return g.EC(S,2),g.a(S,cTV(A,n),4);case 4:return L=S.J,g.a(S,B0w(L),5);case 5:O=RTc(L);g.ij(S,3);break;case 2:J=g.M5(S),Oz("getAndProcessSmartDownloadsResponse request or processing error",J);case 3:return S.return(O)}})},b8h=function(A,n,O,L){var J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I,B,q,W,Ju,cj,Au,z,F,x,k,ZU,CW,nW;
return g.P(function(sC){switch(sC.U){case 1:return g.a(sC,XK(),2);case 2:J=sC.J;if(!J)return sC.return([]);S=[];if((N=L)==null?0:N.length){S=L;sC.TV(3);break}return g.a(sC,FK(J,"musicPlaylist"),4);case 4:S=sC.J;case 3:if(!S.length)return sC.return([]);G=[];b=Date.now()/1E3;t=g.f(S);l=t.next();case 5:if(l.done)return G.length?g.a(sC,JTN(G),10):sC.return([]);D=l.value;Y=void 0;T=(m=(Y=D)==null?void 0:Y.entityMetadata)&&m.nextAutoRefreshIntervalSeconds?Number(m.nextAutoRefreshIntervalSeconds):NaN;K=
Number.isNaN(T)?A:T;p=C=0;H="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!D.downloadMetadata){sC.TV(8);break}return g.a(sC,e2(J,D.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:u=sC.J,B=I=void 0,C=Number((B=(I=u)==null?void 0:I.addedTimestampMillis)!=null?B:"0")/1E3,W=q=void 0,p=Number((W=(q=u)==null?void 0:q.lastModifiedTimestampMillis)!=null?W:"0")/1E3,cj=Ju=void 0,H=(cj=(Ju=u)==null?void 0:Ju.syncState)!=null?cj:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Au=void 0;if(O||H!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!m||Number((Au=m.lastSyncedTimestampSeconds)!=null?Au:0)+K<=b){z=[];F=void 0;if((F=D.tracks)==null?0:F.length)for(x=g.f(D.tracks),k=x.next();!k.done;k=x.next())ZU=k.value,z.push(g.DP(ZU).entityId);CW={playlistId:D.playlistId,videoIds:z,offlineLastModifiedTimestamp:String(p.toFixed()),autoSync:n,offlineDateAddedTimestamp:String(C.toFixed())};G.push(CW)}l=t.next();sC.TV(5);break;case 10:return nW=sC.J,sC.return(nW)}})},cTV=function(A,n){var O,L,J,S,N,G,b,t,l,D;
return g.P(function(Y){switch(Y.U){case 1:return O=g.la(),g.a(Y,XK(),2);case 2:L=Y.J;if(!L){Y.TV(3);break}return g.a(Y,bnV(L),4);case 4:J=Y.J;case 3:var m=J;S={context:g.m7(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:A},offlineClientState:m,clientStateRequestData:{preferredFormatType:n}}}};N=g.x2(tIW);g.EC(Y,5);b={cM:!0};return g.a(Y,g.AF(O,S,N,void 0,b),7);case 7:G=Y.J;g.ij(Y,6);break;case 5:t=g.M5(Y);if(t instanceof g.GC)throw l=
"DPS network manager error for smart downloads: "+t.message,Oz(l,t),Error(l);Oz("DPS fetch request error for smart downloads",t);throw Error("DPS fetch request error for smart downloads");case 6:D=jq(G);if(G)D!==void 0&&ra(D,"smart downloads");else throw Oz("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return Y.return(G)}})},DDK=function(A,n){var O,L,J,S,N,G,b,t;
return g.P(function(l){switch(l.U){case 1:return O=g.la(),L={context:g.m7(),videoPlaybackPositionEntities:A,lastSyncTimestampUsec:n},J=g.x2(lBd),g.EC(l,2),N={cM:!0},g.a(l,g.AF(O,L,J,void 0,N),4);case 4:S=l.J;g.ij(l,3);break;case 2:G=g.M5(l);if(G instanceof g.GC)throw b="VPPS network manager error: "+G.message,Oz(b,G),Error(b);Oz("VPPS fetch request error",G);throw Error("VPPS fetch request error");case 3:t=jq(S);if(S)t!==void 0&&ra(t,"position sync");else throw Oz("Network request failed for position sync"),
Error("Network request failed for position sync");return l.return(S)}})},mDc=function(A,n,O){var L,J,S,N,G,b,t,l;
return g.P(function(D){switch(D.U){case 1:L=g.la();var Y=O.refreshData,m=O.isEnqueuedForExpiredStreamUrlRefetch,T=O.Zn,K=O.offlineSourceData,C=O.mediaCapabilities,p={entityKey:A};Y&&(p.refreshData=Y);m&&(p.isExpiredStreamUrlRefetch=m);T&&(p.downloadParameters=T);K&&(p.offlineSourceData=K);Y={context:g.O$(n),signatureTimestamp:20122,videos:[p]};C&&(Y.mediaCapabilities=C);J=Y;S=g.x2(Y8V);g.EC(D,2);G={cM:!0};return g.a(D,g.AF(L,J,S,void 0,G),4);case 4:N=D.J;g.ij(D,3);break;case 2:b=g.M5(D);if(b instanceof
g.GC)throw t="GetPDE network manager error: "+b.message,Oz(t,b),Error(t);Oz("GetPDE fetch request error",b);throw Error("GetPDE fetch request error");case 3:l=jq(N);if(N)l!==void 0&&ra(l,"PDE");else throw Oz("Network request failed for PDE"),Error("Network request failed for PDE");return D.return(N)}})},jq=function(A){var n;
return(n=A.errorMetadata)==null?void 0:n.status},ra=function(A,n){n=n?" for "+n:"";
if(A===0)throw A="Empty response body"+n,Oz(A),Error(A);A="Response with error"+n;Oz(A);throw Error(A);},JTN=function(A){var n,O,L,J,S,N,G,b;
return g.P(function(t){switch(t.U){case 1:return n=g.la(),O=LDK(A),L=g.x2(TKp),g.EC(t,2),S={cM:!0},g.a(t,g.AF(n,O,L,void 0,S),4);case 4:J=t.J;g.ij(t,3);break;case 2:N=g.M5(t);if(N instanceof g.GC)throw G="offlinePlaylistSyncCheck network manager error: "+N.message,Oz(G,N),Error(G);Oz("offlinePlaylistSyncCheck fetch request error",N);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:b=jq(J);if(!J)throw Oz("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(b!==void 0)ra(b,"playlist sync");else if(!J.offlinePlaylistSyncCheckDatas||!J.offlinePlaylistSyncCheckDatas.length)throw Oz("No data for playlist sync"),Error("No data for playlist sync");return t.return(J.offlinePlaylistSyncCheckDatas.map(function(l){return l.offlinePlaylistSyncCheckData}))}})},aK=function(A){this.U=A},dDh=function(A,n){var O,L,J,S,N,G;
return g.P(function(b){switch(b.U){case 1:O=new Map,L=g.f(n),J=L.next();case 2:if(J.done){b.TV(4);break}S=J.value;N=O;G=N.set;return g.a(b,A.J(S),5);case 5:G.call(N,S,b.J);J=L.next();b.TV(2);break;case 4:return b.return(O)}})},ue=function(A,n,O,L,J,S){n=g.YU(n,O);
L=Object.assign({},S,{priority:L,retryScheduleIntervalsInSeconds:J});return{actionType:A,entityKey:n,actionMetadata:L}},Pf=function(A,n,O,L,J,S){this.status=A;
this.U=n;this.L=O;this.J=L;this.C=J;this.downloadState=S},xDK=function(A,n,O){this.U=A;
this.UN=n;this.C=O},EQR=function(A,n){var O,L,J,S,N,G,b,t,l;
return g.P(function(D){switch(D.U){case 1:return O=n.entityKey,J=(L=g.h(n.actionMetadata,yB))==null?void 0:L.isEnqueuedForExpiredStreamUrlRefetch,g.EC(D,2),S=void 0,g.a(D,fB6(A,n),4);case 4:S=D.J;g.EC(D,5);var Y=(Y=g.h(n.actionMetadata,yB))?{maximumDownloadQuality:Y.maximumDownloadQuality}:void 0;return g.a(D,mDc(O,A.UN,{isEnqueuedForExpiredStreamUrlRefetch:J,Zn:Y,offlineSourceData:S}),7);case 7:N=D.J;g.ij(D,6,2);break;case 5:return g.M5(D,2),G=Gv(n)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Oz("PDE handleAdd error"),D.return(IK(n,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",G,"DOWNLOAD_STATE_FAILED"));case 6:return g.a(D,K6c(A,N,n),8);case 8:return D.return(IK(n,!0,N.orchestrationActions));case 2:return b=g.M5(D),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.UU&&b.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Oz("PDE handleAdd error"),D.return(IK(n,!1,void 0,t,l,"DOWNLOAD_STATE_FAILED"))}})},MIN=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I,B,q,W,Ju,cj;
return g.P(function(Au){switch(Au.U){case 1:return O=n.entityKey,L=g.DP(O).entityId,g.a(Au,wT(A.U,{mode:"readonly",iA:!0},function(z){var F=VT(z,O,"playbackData"),x=VT(z,g.YU(L,"offlineVideoPolicy"),"offlineVideoPolicy");z=VT(z,g.YU(L,"transfer"),"transfer");return g.uO.all([F,x,z])}),2);
case 2:J=Au.J;S=g.f(J);N=S.next().value;G=S.next().value;b=S.next().value;t=N;l=G;D=b;if(!t||!l)return Au.return(IK(n,!0));Y=[];K=((T=t)==null?0:T.playerResponseJson)?JSON.parse(t.playerResponseJson):null;if(!(D&&K&&A.UN.D("html5_refresh_deprecated_downloads"))){Au.TV(3);break}m=CpR(A,K,D);return g.a(Au,i86(A,D),4);case 4:Y=Au.J;case 3:C={lastPlayerResponseTimestampSeconds:t.playerResponseTimestamp,offlineToken:l.offlineToken,formatIds:Y};p={};if((H=D)==null?0:H.maximumDownloadQuality)p.maximumDownloadQuality=
D.maximumDownloadQuality;g.EC(Au,5);u=void 0;return g.a(Au,fB6(A,n),7);case 7:return u=Au.J,g.EC(Au,8),g.a(Au,mDc(O,A.UN,{refreshData:C,Zn:p,offlineSourceData:u,mediaCapabilities:m}),10);case 10:I=Au.J;g.ij(Au,9,5);break;case 8:return g.M5(Au,5),B=Gv(n)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Oz("PDE handleRefresh error"),Au.return(IK(n,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",B,
"DOWNLOAD_STATE_FAILED"));case 9:return g.a(Au,K6c(A,I,n),11);case 11:return Au.return(IK(n,!0,I.orchestrationActions));case 5:return q=g.M5(Au),W="PDE handleRefresh error",q instanceof Error&&(W="PDE handleRefresh error: "+q.message),Ju="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",cj="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.UU&&q.type==="QUOTA_EXCEEDED"&&(Ju="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",cj="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Oz(W),Au.return(IK(n,!1,void 0,Ju,cj,"DOWNLOAD_STATE_FAILED"))}})},fB6=function(A,n){var O,L,J,S;
return g.P(function(N){if(N.U==1)return O=g.DP(n.entityKey).entityId,L=g.YU(O,"videoDownloadContextEntity"),g.a(N,e2(A.U,L,"videoDownloadContextEntity"),2);J=N.J;return(S=J)!=null&&S.offlineModeType?N.return({offlineModeType:J.offlineModeType}):N.return(void 0)})},K6c=function(A,n,O){var L,J,S,N,G;
return g.P(function(b){if(b.U==1){if(!n.frameworkUpdates||!g.h(n.frameworkUpdates,ie))return b.return();if(!(g.h(n.frameworkUpdates,ie).mutations&&g.h(n.frameworkUpdates,ie).mutations.length>0&&g.h(n.frameworkUpdates,ie).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return b.TV(2);L=g.DP(g.h(n.frameworkUpdates,ie).mutations[0].entityKey).entityId;return g.a(b,Md(A.U,L),3)}if(b.U!=2){J=b.J;S=g.h(O.actionMetadata,yB);if(G=(N=S)==null?void 0:N.playlistId)J.playlistId=G;J.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Wp(A.UN)?g.a(b,Cs(L,A.U,O,A.C,J),2):g.zD(A.UN)?g.a(b,ps(L,A.U,O,A.C),2):b.TV(2)}return g.a(b,kkp(g.h(n.frameworkUpdates,ie)),0)})},IK=function(A,n,O,L,J,S){return new Pf(n?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Gv(A),O,L,J,S)},CpR=function(A,n,O){n=rKd(A.UN,O.cotn,n);
O=g.Sb(n);return g.uzj(n,O,A.UN)},i86=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y;
return g.P(function(m){if(m.U==1)return O=[],g.a(m,wT(A.U,{mode:"readonly",iA:!0},function(T){var K=[],C=n.offlineVideoStreams;if(C){C=g.f(C);for(var p=C.next();!p.done;p=C.next())K.push(VT(T,p.value,"offlineVideoStreams"))}return g.uO.all(K)}),2);
if(L=m.J)for(J=g.f(L),S=J.next();!S.done;S=J.next())if(N=S.value,G=void 0,(G=N)==null?0:G.streamsProgress)for(b=N.streamsProgress,t=0;t<b.length;t++)l=b[t],D=JSON.parse(l.formatStreamBytes),Y={itag:D.itag,lmt:D.lastModified,xtags:D.xtags},O.push(Y);return m.return(O)})},p3R=function(A,n){this.U=A;
this.UN=n},UDV=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m;
return g.P(function(T){switch(T.U){case 1:return O=Gv(n),g.a(T,FK(A.U,"videoPlaybackPositionEntity"),2);case 2:L=T.J;if(L.length===0)return T.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.EC(T,3);return g.a(T,$y.getInstance(),5);case 5:J=T.J;if(!J)throw Error("prefStorage is undefined");return g.a(T,J.get("psi"),6);case 6:return S=T.J,b=(G=(N=S)==null?void 0:N.vD)!=null?G:"0",g.a(T,DDK(L,b),7);case 7:return t=T.J,l={isPaused:t.watchHistoryPaused,vD:t.syncTimestampUsec},g.a(T,J.set("psi",
l),8);case 8:if(l.isPaused){T.TV(9);break}D=g.h(t.frameworkUpdates,ie);if(!t.frameworkUpdates||!D){T.TV(9);break}return g.a(T,kkp(D),9);case 9:g.ij(T,4);break;case 3:return Y=g.M5(T),m="PPE handleRefresh error: "+(Y instanceof Error?Y.message:"unknown error"),Oz(m),T.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return T.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},s2p=function(A,n){var O,L,J,S,N,G,b,t;
return g.P(function(l){switch(l.U){case 1:return O=Gv(n),L=g.DP(n.entityKey).entityId,g.EC(l,2),g.a(l,$y.getInstance(),4);case 4:J=l.J;if(!J)throw Error("prefStorage is undefined");return g.a(l,J.get("psi"),5);case 5:S=l.J;N=g.h(n.actionMetadata,H8d);if(((G=S)==null?void 0:G.isPaused)!==!1||(b=N)==null||!b.lastPlaybackPositionSeconds){l.TV(6);break}t={key:g.YU(L,"videoPlaybackPositionEntity"),videoId:L,lastPlaybackPositionSeconds:N.lastPlaybackPositionSeconds};return g.a(l,Wa(A.U,t,"videoPlaybackPositionEntity"),
6);case 6:g.ij(l,3);break;case 2:return g.M5(l),l.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return l.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},gQp=function(A,n){var O,L,J;
return g.P(function(S){switch(S.U){case 1:O=Gv(n);g.EC(S,2);L=g.DP(n.entityKey).entityId;if(L==="!*$_ALL_ENTITIES_!*$")return g.a(S,RSL(A.U),5);J=g.YU(L,"videoPlaybackPositionEntity");return g.a(S,VMN(A.U,J),5);case 5:g.ij(S,3);break;case 2:return g.M5(S),S.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return S.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},j2K=function(A,n){this.api=A;
this.U=n;this.logger=new g.O1("woffle");this.J=!1;this.uo={U8:this.U8};this.logger.debug("Initialized OfflineMediaManager")},rTw=function(A){return g.P(function(n){return n.return(AKd(A))})},aB3=function(A){var n;
return g.P(function(O){if(O.U==1)return g.a(O,g.Zba(A),2);n=O.J;return O.return(n.filter(function(L){return!!L.url}).map(function(L){return L.url}))})},QB=function(A,n){var O=g.sA(n);
if(O===1||O===0)return Promise.resolve();(O=u96(A,n))&&O.stopVideo();A.C=0;return rTw(n)},$7=function(A,n,O,L){O=O===void 0?!1:O;
L=L===void 0?!0:L;var J=typeof n==="string"?n:n.videoDetails.videoId;g.sA(J)===2&&((n=u96(A,J))?n.stopVideo():A.logger.info(function(){return"Corresponding player for "+J+" not found. Pausing anyway"}),g.g$(J,2),A.C=2,O?Ppr(A.U):L&&yTV(A.U))},u96=function(A,n){var O;
return((O=A.player)==null?void 0:O.getVideoData().videoId)===n?A.player:null},IBX=function(A,n,O){n.getPlayerResponse();
g.g$(n.videoId,2);A.C=2;A.J=!1;var L;(L=A.player)==null||L.dispose();A.player=A.api.EE(n);n={};A.player.A9((n.localmediachange=A.tO,n.signatureexpired=A.YC,n.statechange=A.txY,n),A);var J=A.U8(O);A.player.pS(g.Ld(J,J,!0,"m"),!1);A.logger.debug(function(){return"Starting headless playback with quality: "+J});
A.player.Fv(!1)},Q2D=function(A,n){this.U=A;
this.UN=n},vQL=function(A,n){var O,L;
return g.P(function(J){switch(J.U){case 1:return O=Gv(n),g.a(J,e2(A.U,n.entityKey,"transfer"),2);case 2:if(L=J.J)return J.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.EC(J,3);return g.a(J,$Dr(A,n),5);case 5:g.ij(J,4);break;case 3:return g.M5(J),J.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return J.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},BKL=function(A,n){var O,L;
return g.P(function(J){switch(J.U){case 1:return O=Gv(n),g.a(J,e2(A.U,n.entityKey,"transfer"),2);case 2:L=J.J;if(!L||L.transferState!=="TRANSFER_STATE_COMPLETE")return J.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.EC(J,3);return g.a(J,$Dr(A,n,!0),5);case 5:g.ij(J,4);break;case 3:return g.M5(J),J.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return J.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},VIw=function(A,n){var O,L,J,S,N,G,b,t,l,D;
return g.P(function(Y){switch(Y.U){case 1:return O=Gv(n),L=g.DP(n.entityKey).entityId,g.a(Y,wT(A.U,{mode:"readonly",iA:!0},function(m){var T=VT(m,n.entityKey,"transfer");m=VT(m,g.YU(L,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.uO.all([T,m])}),2);
case 2:J=Y.J;S=g.f(J);N=S.next().value;G=S.next().value;b=N;t=G;if(!b||b.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return Y.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.EC(Y,3);b.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.a(Y,Wa(A.U,b,"transfer"),5);case 5:l=g.DP(b.key).entityId;cf({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:l,Ow:b,offlineModeType:(D=t)==null?void 0:D.offlineModeType});g.ij(Y,
4);break;case 3:return g.M5(Y),Y.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Y.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},$Dr=function(A,n,O){O=O===void 0?!1:O;
var L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p;return g.P(function(H){switch(H.U){case 1:return L=g.h(n.actionMetadata,R76),J=g.DP(n.entityKey).entityId,S=g.YU(J,"downloadStatusEntity"),g.a(H,wT(A.U,{mode:"readonly",iA:!0},function(u){var I=VT(u,S,"downloadStatusEntity");u=VT(u,g.YU(J,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.uO.all([I,u])}),2);
case 2:return N=H.J,G=g.f(N),b=G.next().value,t=G.next().value,l=b,D=t,Y="TRANSFER_STATE_TRANSFER_IN_QUEUE",((m=l)==null?void 0:m.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(Y="TRANSFER_STATE_PAUSED_BY_USER"),C={key:n.entityKey,transferState:Y,cotn:g.r_(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(T=L)==null?void 0:T.maximumDownloadQuality,preferredAudioTrack:(K=L)==null?void 0:K.preferredAudioTrack,transferRetryCount:0,isRefresh:O,hasLoggedFirstStarted:!1},g.a(H,wT(A.U,
{mode:"readwrite",iA:!0},function(u){var I=[];O&&I.push(oe(u,g.YU(J,"offlineVideoStreams")));I.push(zz(u,C,"transfer"));return g.uO.all(I)}),3);
case 3:if(!O){H.TV(4);break}return g.a(H,rTw(J),4);case 4:cf({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:J,Ow:C,offlineModeType:(p=D)==null?void 0:p.offlineModeType}),g.Kx(H)}})},z76=function(A,n,O,L){if(!A.action.entityKey)throw Error("entityKey is missing.");
var J=g.DP(A.action.entityKey);J={entityType:J.xM,entityId:J.entityId,offlineOrchestrationActionType:A.action.actionType,orchestrationAction:{orchestrationActionId:A.actionId}};n&&(J.offlineOrchestrationActionResult=n.status,J.isRetryable=O?!1:n.U,n.C&&(J.offlineOrchestrationFailureReason=h7V(n.C,J.isRetryable)));var S,N;if((S=A.action.actionMetadata)==null?0:(N=S.offlineLoggingData)==null?0:N.offlineModeType)J.offlineModeType=A.action.actionMetadata.offlineLoggingData.offlineModeType;L&&(J.additionalOrchestrationActions=
L.map(function(G){return{orchestrationActionId:G.actionId}}));
return J},h7V=function(A,n){return A!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||n?A==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&n?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":A:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},oQV=function(A,n){var O={offlineOrchestrationContext:z76(A)};
n=cKR(n,O);GiR(N03(),n,A.rootActionId)},q8L=function(A,n,O,L){L=L===void 0?[]:L;
n={offlineOrchestrationContext:z76(A,n,O,L)};n=cKR(3,n);GiR(N03(),n,A.rootActionId)},kcc=function(){this.actions=[]},w3X=function(A,n){n=g.f(n);
for(var O=n.next();!O.done;O=n.next())O=O.value,oQV(O,1),A.actions.push(O);A.actions.sort(A.U)},W6W=function(A,n){if(n)for(var O=0;O<A.actions.length;O++)if(n==="!*$_ALL_ENTITIES_!*$"&&A.actions[O].actionId!==n||n!=="!*$_ALL_ENTITIES_!*$"&&A.actions[O].rootActionId===n&&A.actions[O].actionId!==n)A.actions.splice(O,1),O--},e7h=function(A,n){A=g.f(A.actions);
for(var O=A.next();!O.done;O=A.next())if(O.value.actionId===n)return!0;return!1},vf=function(A,n,O,L,J){g.V.call(this);
var S=this;this.J=A;this.aB=n;this.wQ=O;this.W=L;this.UN=J;this.U=new kcc;this.Z=new g.OY;this.C=new g.cy(function(){S.retry()});
this.G=NaN;this.B=!1;this.uo={qWe:function(){return S.U},
xB:function(){return S.Z},
clY:function(){return S.C},
retry:function(){return S.retry()}};
g.R(this,this.C);this.X=this.J.observe(this.t5.bind(this))},Z8r=function(A,n,O,L,J){var S;
return g.P(function(N){if(N.U==1)return S=new vf(A,n,O,L,J),g.a(N,F6c(S),2);X33(S);return N.return(S)})},X33=function(A){var n=A.U.actions[0];
return A.L?((n==null?void 0:n.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&A.L[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(A.B=!0),Promise.resolve()):AcK(A)},AcK=function(A){var n,O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p;
return g.P(function(H){switch(H.U){case 1:if(A.L)throw Error("Already processing an action");if(A.gQ())return H.return();n=A.U.actions.shift();CRD(A.wQ,!n);if(n===void 0)return H.return();n.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&n.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&W6W(A.U,n.actionId);O="";n.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&n.rootActionId===n.actionId&&(O=n.actionId);L=[n];A.L=L;if(J=A.aB[n.entityType]){H.TV(2);break}A.L=
void 0;return g.a(H,AcK(A),3);case 3:return H.return();case 2:S=g.f(L);for(N=S.next();!N.done;N=S.next())G=N.value,oQV(G,2);g.EC(H,4,5);return g.a(H,dDh(J,L.map(function(u){return u.action})),7);
case 7:b=H.J,t=g.f(L),l=t.next();case 8:if(l.done){H.TV(10);break}D=l.value;Y=b.get(D.action);return g.a(H,nur(A,D,Y),9);case 9:l=t.next();H.TV(8);break;case 10:W6W(A.U,O);case 5:g.px(H);A.L=void 0;g.UC(H,6);break;case 4:return m=g.M5(H),Oz("Orchestration error",m),g.EC(H,12),g.a(H,OAw(A,L),14);case 14:g.ij(H,5);break;case 12:T=g.M5(H);Oz("Orchestration retry error",T);K=g.f(L);for(C=K.next();!C.done;C=K.next())p=C.value,p.retryScheduleIndex<3&&w3X(A.U,[p]);H.TV(5);break;case 6:return g.a(H,AcK(A),
0)}})},nur=function(A,n,O){var L,J,S,N,G,b,t,l,D,Y,m,T;
return g.P(function(K){switch(K.U){case 1:L=n.retryScheduleIndex+2===3;if(O.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){K.TV(2);break}if(O.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){K.TV(0);break}q8L(n,O,L);if(O.U&&n.retryScheduleIndex+1<3)return g.a(K,OAw(A,[n]),0);S=((J=O)==null?0:J.J)?O.J:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";N={entityKey:n.action.entityKey,failureReason:S};G=void 0;g.Wp(A.UN)?G="mainVideoDownloadStateEntity":g.zD(A.UN)&&(G="musicTrackDownloadMetadataEntity");
if(!G||!O.downloadState){K.TV(7);break}b=g.DP(n.action.entityKey).entityId;return g.a(K,DD(b,G,A.J,O.downloadState),7);case 7:JS(A.W,N);if(O.downloadState==="DOWNLOAD_STATE_FAILED"&&A.UN.D("html5_auto_retry_failed_pde_actions")){K.TV(0);break}Oz("Orchestration result is not retryable, deleting action");return g.a(K,VMN(A.J,fs(n).key),0);case 2:t=void 0;try{t=(l=O.L)==null?void 0:l.map(function(C){return A.createAction(C,n)})}catch(C){return q8L(n,O,L),D={entityKey:n.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},JS(A.W,D),Oz("Orchestration subactions creation error",C),K.return()}q8L(n,O,L,t);if(!t){K.TV(12);break}Y=t.map(function(C){return fs(C)});
m=0;case 13:if(!(m<t.length)||A.B){K.TV(15);break}return g.a(K,wT(A.J,{mode:"readwrite",iA:!0},function(C){var p=[];p.push(rt6(C,Y.slice(m,m+10),"offlineOrchestrationActionWrapperEntity"));return g.uO.all(p)}),16);
case 16:m+=10;K.TV(13);break;case 15:if(A.B)return A.B=!1,K.return();case 12:return T=fs(n),g.a(K,VMN(A.J,T.key),17);case 17:oQV(n,4),g.Kx(K)}})},NoL=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m;
return g.P(function(T){O=[];L=Infinity;J=4E3;S=g.f(n);for(N=S.next();!N.done;N=S.next())G=N.value,b=Number(G.enqueueTimeSec),t=Li6(b),l=G.retryScheduleIndex,D=l!=null&&l>0,t>0&&D?(L=Math.min(L,b),J=Math.min(t,J)):O.push(G);isFinite(L)&&(!A.C.isActive()||L<A.G)&&(A.G=L,A.C.start(J));A.Z.Ab()||(Y=O.length,O=O.filter(function(K){var C;K=((C=K.actionProto)==null?void 0:C.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!Jch.includes(K)}),m=O.length<Y,!A.C.isActive()&&m&&A.C.start(1));
O.length>0&&STd(A,O);return g.a(T,X33(A),0)})},G13=function(A){var n,O,L,J,S,N,G;
return g.P(function(b){if(b.U==1)return g.a(b,ccK(A),2);n=b.J;O=[];L=g.f(n);for(J=L.next();!J.done;J=L.next())S=J.value,N=g.DP(S.key),G=N.entityId,e7h(A.U,G)||O.push(S);return g.a(b,NoL(A,O),0)})},Li6=function(A){A=A*1E3-Date.now();
return A>4E3?4E3:A},OAw=function(A,n){var O,L,J;
return g.P(function(S){O=g.f(n);for(L=O.next();!L.done;L=O.next()){J=L.value;var N=void 0,G=void 0,b=((G=J.action)==null?void 0:(N=G.actionMetadata)==null?void 0:N.retryScheduleIntervalsInSeconds)||[1,2,4];N=1;J.retryScheduleIndex<b.length&&(N=b[J.retryScheduleIndex]);J.U=N*1E3+Date.now();J.retryScheduleIndex++}return g.a(S,bAL(A,n),0)})},F6c=function(A){var n;
return g.P(function(O){if(O.U==1)return g.a(O,FK(A.J,"offlineOrchestrationActionWrapperEntity"),2);n=O.J;return g.a(O,NoL(A,n),0)})},STd=function(A,n){n.length!==0&&n.forEach(function(O){O=x7(O);
O.retryScheduleIndex<3&&w3X(A.U,[O])})},ccK=function(A,n){var O;
return g.P(function(L){if(L.U==1)return g.a(L,FK(A.J,"offlineOrchestrationActionWrapperEntity",n),2);O=L.J;return L.return(O.filter(w4d))})},bAL=function(A,n){if(n.length===0)return Promise.resolve([]);
n=n.map(function(O){return fs(O)});
return BBW(A.J,n)},tsR=function(A){this.Ws=A;
this.U=void 0},lYc=function(A,n){var O,L,J,S;
return g.P(function(N){O=n.videoId;L=!0;if(n.captionTracks.length)J=jVr(n),A.U=new g.Hz(A.Ws,n,J);else if(n.gi)S=g.GKx(n),A.U=new g.gE(A.Ws,n.gi,O,S,n.a9,n.eventId),L=n.a9;else return N.return();return N.return(new Promise(function(G){var b;(b=A.U)==null||b.xa({SO:function(){return g.P(function(t){if(t.U==1)return g.a(t,A.SO(O,L),2);G();g.Kx(t)})},
cW:function(){}})}))})},DKw=function(A){var n;
return g.P(function(O){if(O.U==1)return g.a(O,ZiN(A),2);n=O.J;return O.return(!!n&&n.length>0)})},Bf=function(A){g.V.call(this);
this.U=A;this.J=this.U.observe(this.C.bind(this))},YT6=function(A,n){var O,L,J,S,N,G,b;
return g.P(function(t){switch(t.U){case 1:if(n.length===0)return t.return([]);O=n.map(function(l){return g.YU(l,"transfer")});
return g.a(t,FK(A.U,"transfer",O),2);case 2:L=t.J;J=L.filter(w4d).map(function(l){return g.DP(l.key).entityId});
S=n.filter(function(l){return J.indexOf(l)===-1});
if(S.length===0)return t.return([]);N=g.f(S);G=N.next();case 3:if(G.done){t.TV(5);break}b=G.value;return g.a(t,rTw(b),4);case 4:G=N.next();t.TV(3);break;case 5:return t.return(S)}})},dKh=function(A,n,O,L,J,S){var N,G,b;
return g.P(function(t){N="STREAM_TYPE_UNKNOWN";O.video&&O.audio?(N="STREAM_TYPE_AUDIO_AND_VIDEO",Oz("unexpected stream type")):O.video&&!O.audio?N="STREAM_TYPE_VIDEO":!O.video&&O.audio&&(N="STREAM_TYPE_AUDIO");G=g.YU(n,"offlineVideoStreams");b={numBytesDownloaded:J.toFixed(),numTotalBytes:S.toFixed(),streamType:N,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(L),itag:N==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(O.itag):void 0};return g.a(t,wT(A,{mode:"readwrite",iA:!0},
function(l){var D=VT(l,G,"offlineVideoStreams"),Y=VT(l,g.YU(n,"transfer"),"transfer");return g.uO.all([D,Y]).then(function(m){m=g.f(m);var T=m.next().value;m=m.next().value;if(!m)return oe(l,G).then(function(){});
var K=mKR(T);T=ToD(T,L,b,G);var C=zz(l,T,"offlineVideoStreams");mKR(T)>K&&(m.lastProgressTimeMs=Date.now().toString());K=[C];m.offlineVideoStreams||(m.offlineVideoStreams=[]);m.offlineVideoStreams.indexOf(G)===-1&&(m.offlineVideoStreams.push(G),K.push(zz(l,m,"transfer")));return g.uO.all(K)})}),0)})},xKr=function(A,n){var O,L,J,S,N;
return g.P(function(G){if(G.U==1)return O=g.YU(n,"offlineVideoStreams"),g.a(G,e2(A,O,"offlineVideoStreams"),2);L=G.J;if(!L||!L.streamsProgress)return G.return();J=g.f(L.streamsProgress);for(S=J.next();!S.done;S=J.next())N=S.value,N.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",N.numTotalBytes!==N.numBytesDownloaded&&(N.numBytesDownloaded=N.numTotalBytes);return g.a(G,Wa(A,L,"offlineVideoStreams"),0)})},ToD=function(A,n,O,L){if(A&&A.streamsProgress){L=A;
a:{n=n.itag+";"+n.xtags;for(var J=A.streamsProgress,S=0;S<J.length;S++){var N=JSON.parse(J[S].formatStreamBytes);if(N.itag+";"+N.xtags===n){J[S]=O;O=J;break a}}J.push(O);O=J}L.streamsProgress=O}else A={key:L,streamsProgress:[O]};return A},mKR=function(A){if(A==null?0:A.streamsProgress){var n=0;
A=A.streamsProgress;for(var O=0;O<A.length;O++){var L=A[O];isNaN(Number(L.numBytesDownloaded))?Oz("stream progress bytes number invalid"):n+=Number(L.numBytesDownloaded)}return n}return 0},fYc=function(A,n,O,L){g.V.call(this);
var J=this;this.J=A;this.api=n;this.lZ=O;this.t5=L;this.Z=new g.OY;this.L=new g.cy(function(){J.U&&J.U.transferState==="TRANSFER_STATE_TRANSFERRING"&&J.Z.Ab()&&((J.U.transferRetryCount||0)<3?$7(J.W,J.B,!1,!1):QB(J.W,J.B.videoDetails.videoId),J.Q$("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.wQ=this.Zu=0;this.X=this.G=!1;this.IB=g.fj(this.api.K().experiments,"html5_transfer_processing_logs_interval");this.zV=new g.Vr(this);this.uo={Rpe:function(){return J.L},
ivu:function(){return J.t5},
xB:function(){return J.Z}};
this.aB=this.J.observe(this.c5.bind(this));this.W=new j2K(n,this);this.VY=new tsR(n);this.oB=new Bf(this.J);this.A5=this.Z.listen("publicytnetworkstatus-online",this.rd.bind(this));this.Hs=this.Z.listen("publicytnetworkstatus-offline",this.k0Y.bind(this));this.X=this.api.K().D("html5_less_transfer_processing_logs");g.R(this,this.zV);this.zV.Y(n,"offlinetransferpause",this.pmg);g.Wp(this.api.K())?this.C="mainVideoDownloadStateEntity":g.zD(this.api.K())&&(this.C="musicTrackDownloadMetadataEntity")},
Kiw=function(A){return g.P(function(n){if(n.U==1)n=g.a(n,FaR(),2);
else{var O=A.oB;var L=g.HJ();L=Object.keys(L);O=YT6(O,L);n=g.a(n,O,0)}return n})},RK=function(A,n){n=n===void 0?!1:n;
var O;return g.P(function(L){if(L.U==1){if(A.U)throw Error("Already downloading a video");A.wQ=0;A.G=!1;return g.a(L,EuW(A),2)}return L.U!=4?(O=L.J,inp(A.lZ,!O),O&&A.Z.Ab()?n?g.a(L,new Promise(function(J){g.pL(J,1E3)}),4):L.TV(4):(!O&&A.U&&VB(A),L.TV(0))):g.a(L,Cih(A,O),0)})},iAp=function(A){return g.P(function(n){if(n.U==1)return A.B?g.a(n,QB(A.W,A.B.videoDetails.videoId),3):n.TV(0);
VB(A);g.Kx(n)})},MsL=function(A,n){var O,L,J;
return g.P(function(S){switch(S.U){case 1:return g.EC(S,2),(O=!!n.captionTracks.length||!!n.gi)?g.a(S,DKw(n.videoId),4):S.return();case 4:return(L=S.J)?S.return():g.a(S,lYc(A.VY,n),5);case 5:g.ij(S,0);break;case 2:J=g.M5(S),Oz("Caption downloading error",J,n.cotn),g.Kx(S)}})},Cih=function(A,n){var O,L,J,S,N,G;
return g.P(function(b){switch(b.U){case 1:if(A.G)return b.return();A.G=!0;A.U=n;O=g.DP(A.U.key);L=O.entityId;J=void 0;if(A.U.transferState==="TRANSFER_STATE_TRANSFERRING")return g.a(b,hS(A,L),7);if(A.U.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||A.U.transferRetryCount||A.U.hasLoggedFirstStarted){b.TV(3);break}return g.a(b,hS(A,L),5);case 5:return J=b.J,A.U.hasLoggedFirstStarted=!0,g.a(b,pNW(A),6);case 6:p0h({videoId:L,Ow:A.U,offlineModeType:J},void 0,void 0,!0);b.TV(3);break;case 7:J=b.J,
cf({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:L,Ow:A.U,offlineModeType:J});case 3:return g.a(b,UKN(A),8);case 8:return S=null,g.EC(b,9),g.a(b,HAW(A,n),11);case 11:S=b.J;A.B=S;g.ij(b,10);break;case 9:return N=g.M5(b),Oz("error getting player response",N,n.cotn),g.a(b,A.Q$("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return b.return();case 10:return G=rKd(A.api.K(),n.cotn,S),g.a(b,MsL(A,G),13);case 13:return g.a(b,aB3(G.videoId),
14);case 14:G.zo=b.J,IBX(A.W,G,n.maximumDownloadQuality),A.L.start(108E5),g.Kx(b)}})},EuW=function(A){var n,O;
return g.P(function(L){if(L.U==1)return g.a(L,FK(A.J,"transfer"),2);n=L.J;O=n.filter(sHc).sort(guL);return O.length===0?L.return():L.return(O[0])})},UKN=function(A){var n,O,L;
return g.P(function(J){if(J.U==1){if(!A.U)return zv(A,"onTransferStart"),J.return();A.L.start(108E5);return g.a(J,oK(A,"TRANSFER_STATE_TRANSFERRING"),2)}n=A.U;return(L=((O=n)==null?0:O.key)?g.DP(n.key).entityId:"")&&A.C?g.a(J,DD(L,A.C,A.J,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):J.TV(0)})},Ppr=function(A){var n,O,L,J;
g.P(function(S){switch(S.U){case 1:if(!A.U){zv(A,"onTransferPausedByUser");S.TV(2);break}n=A.U;A.L.stop();return g.a(S,oK(A,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:L=((O=n)==null?0:O.key)?g.DP(n.key).entityId:"";if(!L||!A.C){S.TV(4);break}return g.a(S,DD(L,A.C,A.J,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.a(S,hS(A,L),6);case 6:J=S.J,Ujp({videoId:L,Ow:n,offlineModeType:J});case 2:VB(A),RK(A),g.Kx(S)}})},yTV=function(A){var n,O,L;
g.P(function(J){if(J.U==1){if(!A.U)return zv(A,"onTransferPausedByNetwork"),J.return();A.L.stop();return g.a(J,oK(A,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(J.U!=3)return n=A.U,(L=((O=n)==null?0:O.key)?g.DP(n.key).entityId:"")&&A.C?g.a(J,DD(L,A.C,A.J,"DOWNLOAD_STATE_PAUSED"),3):J.TV(3);VB(A);g.Kx(J)})},jHD=function(A){var n,O,L,J,S;
g.P(function(N){switch(N.U){case 1:if(!A.U)return zv(A,"onTransferComplete"),N.return();n=A.U;A.L.stop();if(!n||!A.B){N.TV(2);break}O=rKd(A.api.K(),n.cotn,A.B);return g.a(N,MsL(A,O),2);case 2:return g.a(N,oK(A,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:J=((L=n)==null?0:L.key)?g.DP(n.key).entityId:"";if(!J||!A.C){N.TV(5);break}return g.a(N,DD(J,A.C,A.J,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.a(N,xKr(A.J,J),7);case 7:return g.a(N,hS(A,J),8);case 8:S=N.J,cf({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:J,Ow:n,offlineModeType:S}),VB(A),RK(A),g.Kx(N)}})},rcV=function(A,n,O){var L,J;
g.P(function(S){switch(S.U){case 1:if(!A.U)return zv(A,"onTransferProgress: "+n),S.return();if(A.U.transferState==="TRANSFER_STATE_TRANSFERRING"){S.TV(2);break}return g.a(S,UKN(A),2);case 2:L=Date.now();if(!(L-A.Zu>1E3)){S.TV(4);break}A.Zu=L;return g.a(S,dKh(A.J,O.videoId,O.J,O.Ei,O.bytesDownloaded,O.U),5);case 5:if(A.X&&!(A.X&&L-A.wQ>A.IB)){S.TV(4);break}A.wQ=L;return g.a(S,hS(A,n),7);case 7:J=S.J,p0h({videoId:n,Ow:A.U,offlineModeType:J},O.bytesDownloaded,O.U);case 4:A.L.start(108E5),g.Kx(S)}})},
aYN=function(A){var n=(A.U.transferRetryCount||0)<3;
n&&(A=A.U,A.transferRetryCount=(A.transferRetryCount||0)+1);return n},uZh=function(A,n){n=n===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":n;
var O,L,J,S;return g.P(function(N){if(N.U==1)return A.U||zv(A,"setTransferToFailed: "+n),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",n==="TRANSFER_FAILURE_REASON_NETWORK"?O="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":n==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.a(N,oK(A,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",n),2);if(N.U!=3)return JS(A.t5,{entityKey:(L=A.U)==null?void 0:L.key,failureReason:O}),
J=A.U?g.DP(A.U.key).entityId:"",g.a(N,hS(A,J),3);S=N.J;var G={videoId:J,Ow:A.U,offlineModeType:S},b=n,t={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};b&&(t.transferFailureReason=b,t.failureReason=Hnd(b));cf(t,G);g.Kx(N)})},oK=function(A,n,O,L){var J;
return g.P(function(S){if(S.U==1){if(!A.U)return zv(A,"saveTransferState: "+n),S.return();A.U.transferState=n;A.U.failureReason=L;g.EC(S,2);return g.a(S,pNW(A,function(N){return O?Re(N,"offlineVideoStreams",A.U.offlineVideoStreams).then(function(G){for(var b=g.f(G),t=b.next();!t.done;t=b.next())if((t=t.value)&&t.streamsProgress){t=g.f(t.streamsProgress);for(var l=t.next();!l.done;l=t.next())l.value.streamState=O}return rt6(N,G.filter(function(D){return!!D}),"offlineVideoStreams")}):g.uO.resolve(void 0)}),
4)}if(S.U!=2)return g.ij(S,0);
J=g.M5(S);return J instanceof g.UU&&J.type==="QUOTA_EXCEEDED"?g.a(S,A.Q$("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):S.TV(0)})},pNW=function(A,n){var O;
return g.P(function(L){if(!A.U)return L.return();O=A.U;return g.a(L,wT(A.J,{mode:"readwrite",iA:!0},function(J){var S=[zz(J,O,"transfer")];n&&S.push(n(J));return g.uO.all(S)}),0)})},VB=function(A){A.U=void 0;
A.B=void 0;A.L.stop()},HAW=function(A,n){var O,L,J,S,N;
return g.P(function(G){if(G.U==1)return O=g.DP(n.key),L=O.entityId,J=g.YU(L,"playbackData"),g.a(G,e2(A.J,J,"playbackData"),2);S=G.J;if((N=S)==null?0:N.playerResponseJson)return G.return(JSON.parse(S.playerResponseJson));throw Error("No PlayerResponse found");})},zv=function(A,n){A.api.uZ("woffle",{mcte:n});
Oz("missing current transfer entity.")},hS=function(A,n){var O,L,J;
return g.P(function(S){if(S.U==1)return g.a(S,e2(A.J,g.YU(n,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);O=S.J;return S.return((J=(L=O)==null?void 0:L.offlineModeType)!=null?J:void 0)})},sHc=function(A){return Pir[A.transferState]!==void 0},guL=function(A,n){var O=Pir[A.transferState],L=Pir[n.transferState];
return O!==L?O-L:Number(A.enqueuedTimestampMs)-Number(n.enqueuedTimestampMs)},qd=function(A,n){var O=this;
this.UN=A;this.api=n;this.Z=new g.OY;this.B=new g.i6;this.uo={Hh:function(){return O.C.uo.Hh()},
xB:function(){return O.Z},
nwQ:function(){return O.C},
NV:function(){return O.NV()},
sy:function(){return O.sy()},
Oy:function(){return O.Oy()},
JS:function(){return O.JS()},
F0:function(){return O.F0()},
SW:function(L){return O.SW(L)}};
this.C=new fmN(function(){return ycV(O)},function(){O.Oy()},this.api.Ox(),this.api.D.bind(this.api));
this.U=new Ls(this.api);KDr(this.C)},ycV=function(A){return g.P(function(n){A.api.sN("onOrchestrationBecameLeader");
return g.a(n,A.sy(),0)})},QHc=function(A){var n,O;
return g.P(function(L){if(L.U==1)return g.a(L,XK(),2);if(L.U!=3){n=L.J;if(!n)return Oz("PES is undefined"),L.return();A.J=new fYc(n,A.api,A.C,A.U);O=A.nX(n);return g.a(L,Z8r(n,O,A.C,A.U,A.UN),3)}A.W=L.J;return g.a(L,IYD(A),0)})},IYD=function(A){var n;
return g.P(function(O){switch(O.U){case 1:if(!A.J)return Oz("transferManager is undefined"),O.return();if(A.J.U){O.TV(2);break}return g.a(O,RK(A.J),2);case 2:if(!A.UN.D("woffle_enable_main_downloads_library")){O.TV(4);break}return g.a(O,A.Km(),4);case 4:if(!A.UN.D("html5_offline_playback_position_sync")){O.TV(6);break}return g.a(O,A.dh(),7);case 7:return g.a(O,A.SW(864E5),6);case 6:return g.a(O,A.refreshAllStaleEntities(43200,!0),9);case 9:return g.a(O,A.jG(),10);case 10:if(!A.UN.D("html5_retry_downloads_for_expiration")){O.TV(11);
break}return g.a(O,A.F0(),11);case 11:return A.G=g.UB(function(){A.refreshAllStaleEntities(43200,!0);A.jG()},9E5),g.cV(g.bO(),function(){return A.JS()}),g.a(O,XK(),13);
case 13:return n=O.J,g.a(O,xjw(n),14);case 14:ElD(A.C),g.Kx(O)}})},$KV=function(){var A,n,O,L,J,S;
return g.P(function(N){switch(N.U){case 1:return g.a(N,XK(),2);case 2:A=N.J;if(!A)return N.return([]);n=Date.now()/1E3;return g.a(N,FK(A,"offlineVideoPolicy"),3);case 3:O=N.J,L=g.f(O),J=L.next();case 4:if(J.done){N.TV(6);break}S=J.value;if(!(S.expirationTimestamp&&Number(S.expirationTimestamp)<n)){N.TV(5);break}S.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";S.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.a(N,Wa(A,S,"offlineVideoPolicy"),5);
case 5:J=L.next();N.TV(4);break;case 6:return N.return(O.map(function(G){return G.key}))}})},k7=function(A,n,O,L,J){var S,N,G;
return g.P(function(b){if(b.U==1)return g.a(b,XK(),2);S=b.J;if(!S)return b.return([]);N=n.map(function(t){var l=g.YU(t,O);l={actionType:L,entityKey:l,actionMetadata:Object.assign({},amd(),J)};L!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(l.actionMetadata.priority=0);t=new da(O,t,l);return fs(t)});
G=BBW(S,N);KDr(A.C);return b.return(G)})},vuR=function(A,n,O,L){var J,S,N,G,b,t,l,D;
return g.P(function(Y){switch(Y.U){case 1:J=[],S=g.f(n),N=S.next();case 2:if(N.done){Y.TV(4);break}G=N.value;if(G.upToDate||O&&!G.shouldAutoSyncMetadata||!G.playlistId){Y.TV(3);break}b={};switch(L){case "mainPlaylistEntity":t={nextAutoRefreshIntervalSeconds:G.checkInSeconds,autoSync:O};b={mainPlaylistEntityActionMetadata:t};break;case "musicPlaylist":l={autoSync:O},b={musicPlaylistEntityActionMetadata:l}}return g.a(Y,k7(A,[G.playlistId],L,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",b),6);case 6:(D=
Y.J)&&J.push.apply(J,g.E(D));case 3:N=S.next();Y.TV(2);break;case 4:return Y.return(J)}})},BoW=function(A,n){var O;
return g.P(function(L){return n.length?(O=amd(),g.kN(O,yB,{isEnqueuedForExpiredStreamUrlRefetch:!0}),A.api.uZ("qrd",{v:n.length}),L.return(k7(A,n,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O))):L.return([])})},VsL=function(A,n,O){this.U=A;
this.UN=n;this.C=O},zOp=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H;
return g.P(function(u){switch(u.U){case 1:return O=Gv(n),L=g.DP(n.entityKey),J=L.entityId,S=[],g.EC(u,2),g.a(u,ROr(A,J),4);case 4:S=u.J;if(!(A.UN.D("woffle_enable_main_downloads_library")&&((N=S)==null?0:N.length))){u.TV(5);break}return g.a(u,olp(A.U,[n.entityKey]),5);case 5:g.ij(u,3);break;case 2:return G=g.M5(u),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.UU&&G.type==="QUOTA_EXCEEDED"?(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Oz("Playlist add error"),u.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,b,t));case 3:l=[];if(!A.UN.D("html5_offline_prevent_redownload_downloaded_video")){u.TV(7);break}return g.a(u,j$N(A.U,"mainVideoEntity",S),8);case 8:S=u.J;case 7:if((D=S)==null?0:D.length)for(Y=g.f(S),m=Y.next();!m.done;m=Y.next())if(T=m.value,K=T.offlineVideoData,C=void 0,(C=K)==null?0:C.videoId)p=void 0,H=Number(((p=n.actionMetadata)==null?void 0:p.priority)||
0)+1,l.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",K.videoId,"mainVideoEntity",H,wa,hOW(n,K,J)));return u.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,l))}})},qT3=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I,B,q,W,Ju,cj,Au,z,F,x,k,ZU,CW,nW,sC,e5,LW,dd,M,U,r,y,v,OC,S5,N5,Q,lj,dR,bj,aa,YV,RL,YW,oa,vx,b3,aC,zH,lv,VG,Bx,Ru,KK,DO,rS,Du,ak,yg,Ip,UI,Fo,h2,Jd,pA,or;
return g.P(function(mU){switch(mU.U){case 1:return O=Gv(n),L=n.entityKey,J=g.DP(L).entityId,S=[],N=!1,J==="!*$_ALL_ENTITIES_!*$"?(N=!0,g.a(mU,FK(A.U,"mainPlaylistEntity"),5)):g.a(mU,e2(A.U,L,"mainPlaylistEntity"),4);case 4:(G=mU.J)&&S.push(G);mU.TV(3);break;case 5:S=mU.J;case 3:if((b=S)==null||!b.length)return mU.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));t=g.h(n.actionMetadata,ouV);D=(l=t)==null?void 0:l.nextAutoRefreshIntervalSeconds;m=(Y=t)==null?void 0:Y.autoSync;T=[];C=K=
!0;p=!1;if(!N&&m===!1){mU.TV(6);break}g.EC(mU,7);return g.a(mU,S8X(0,!!m,!0,S),9);case 9:T=mU.J;g.ij(mU,8);break;case 7:H=g.M5(mU);if(!(H instanceof Error&&H.message==="No data")){H instanceof Error&&H.message==="Empty response body"&&Oz(H.message);mU.TV(8);break}return J==="!*$_ALL_ENTITIES_!*$"?g.a(mU,vld(A.U,n,A.C,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.a(mU,Q$V(J,A.U,n,A.C),8);case 8:if(!T.length||!N&&T[0].playlistId!==J)return mU.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O));case 6:if(N){u=[];I=g.f(T);for(B=I.next();!B.done;B=I.next())q=B.value,q.upToDate||m&&!q.shouldAutoSyncMetadata||!q.playlistId||(W={nextAutoRefreshIntervalSeconds:q.checkInSeconds,autoSync:m},u.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q.playlistId,"mainPlaylistEntity",0,wa,{mainPlaylistEntityActionMetadata:W})));return mU.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,u))}T.length&&(Ju=T[0],p=!!Ju.upToDate,m&&(K=(cj=Ju.shouldAutoSyncMetadata)!=null?cj:!0,C=(Au=Ju.shouldAutoSyncVideos)!=
null?Au:!0,Ju.checkInSeconds&&(D=Ju.checkInSeconds)));if(p||!K)return mU.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));z=[];F=S[0];if(!F.downloadState){x=void 0;mU.TV(15);break}return g.a(mU,e2(A.U,F.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:x=mU.J;case 15:return k=x,CW=((ZU=k)==null?0:ZU.addedTimestampMillis)?String(k.addedTimestampMillis):void 0,g.EC(mU,17),g.a(mU,ROr(A,J,CW,D),19);case 19:z=mU.J;g.ij(mU,18);break;case 17:nW=g.M5(mU);if(!(nW instanceof Error&&
nW.message==="No data for playlist")){if(nW instanceof Error&&nW.message==="Empty response body for playlist")Oz(nW.message);else return sC="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e5="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",nW instanceof g.UU&&nW.type==="QUOTA_EXCEEDED"&&(sC="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",e5="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),mU.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,sC,e5));mU.TV(18);
break}return g.a(mU,Q$V(J,A.U,n,A.C),18);case 18:if(!C)return mU.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));LW=[];dd=new Map;if((M=z)==null?0:M.length)for(U=g.f(z),r=U.next();!r.done;r=U.next())y=r.value,v=y.offlineVideoData,OC=void 0,((OC=v)==null?0:OC.videoId)&&dd.set(v.videoId,v);S5=new Map;N5=[];if((Q=F)==null?0:(lj=Q.videos)==null?0:lj.length)for(dR=g.f(F.videos),bj=dR.next();!bj.done;bj=dR.next())if(aa=bj.value,YV=JSON.parse(g.DP(aa).entityId),RL=YV.videoId)dd.has(RL)?(S5.set(RL,
dd.get(RL)),dd.delete(RL)):N5.push(RL);oa=Number(((YW=n.actionMetadata)==null?void 0:YW.priority)||0)+1;vx=g.f(dd.entries());for(b3=vx.next();!b3.done;b3=vx.next())aC=b3.value,zH=g.f(aC),lv=zH.next().value,VG=zH.next().value,Bx=lv,Ru=VG,LW.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Bx,"mainVideoEntity",oa,wa,hOW(n,Ru,J)));KK=g.f(S5.entries());for(DO=KK.next();!DO.done;DO=KK.next())rS=DO.value,Du=g.f(rS),ak=Du.next().value,yg=Du.next().value,Ip=ak,UI=yg,LW.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Ip,"mainVideoEntity",oa,wa,hOW(n,UI,J)));Fo=g.f(N5);for(h2=Fo.next();!h2.done;h2=Fo.next())Jd=h2.value,pA={playlistId:J},or={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:pA},LW.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Jd,"mainVideoEntity",0,wa,or));return mU.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,LW))}})},k1D=function(A,n){var O,L,J,S;
return g.P(function(N){switch(N.U){case 1:return O=Gv(n),g.EC(N,2),L=g.DP(n.entityKey).entityId,L==="!*$_ALL_ENTITIES_!*$"?g.a(N,vld(A.U,n,A.C,(J=n.actionMetadata)==null?void 0:(S=J.offlineLoggingData)==null?void 0:S.offlineDeleteReason),5):g.a(N,Q$V(L,A.U,n,A.C),6);case 6:if(!A.UN.D("woffle_enable_main_downloads_library")){N.TV(5);break}return g.a(N,qbL(A.U,n.entityKey),5);case 5:g.ij(N,3);break;case 2:return g.M5(N),N.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},ROr=function(A,n,O,L){var J,S,N,G,b,t,l;
return g.P(function(D){switch(D.U){case 1:return g.a(D,L6R([n]),2);case 2:return J=D.J,g.a(D,wNV(A,J[0],O,L),3);case 3:return S=D.J,N=S.mainPlaylistEntity,G=S.za5,t=yKL(N,(b=G)==null?void 0:b.avatar),g.EC(D,4),g.a(D,Ez(t),6);case 6:g.ij(D,5);break;case 4:l=g.M5(D),l instanceof Error&&l.message==="Failed to fetch"&&Oz(l.message);case 5:return D.return(J[0].videos)}})},wNV=function(A,n,O,L){var J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I;
return g.P(function(B){switch(B.U){case 1:J=Date.now().toString();O||(O=J);S=n.videos;N=n.playlistId;G=[];b=[];if(S)for(t=g.f(S),l=t.next();!l.done;l=t.next()){D=l.value;Y=D.offlineVideoData;if(!Y||!Y.videoId)throw Oz("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");m=Y.videoId;T={videoId:m,playlistId:N};K={id:g.YU(JSON.stringify(T),"mainPlaylistVideoEntity"),video:g.YU(m,"mainVideoEntity")};G.push(K);b.push(K.id)}p={key:g.YU(N,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:O,lastSyncedTimestampMillis:J};H={key:g.YU(N,"mainPlaylistEntity"),playlistId:N,videos:b,title:n.title,thumbnailStyleData:WiK(n),visibility:eOd(n),downloadState:p.key};n.channel&&(u=n.channel.offlineChannelData,C=Fiw(g.YU(N,"ytMainChannelEntity"),u),H.channelOwner=C.id);((I=H)==null?0:I.entityMetadata)?(H.entityMetadata.offlineLastModifiedTimestampSeconds=n.lastModifiedTimestamp,L&&(H.entityMetadata.nextAutoRefreshIntervalSeconds=String(L))):H&&(H.entityMetadata={nextAutoRefreshIntervalSeconds:L?
String(L):void 0,offlineLastModifiedTimestampSeconds:n.lastModifiedTimestamp});g.EC(B,2);return g.a(B,wT(A.U,{mode:"readwrite",iA:!0},function(q){var W=zz(q,H,"mainPlaylistEntity"),Ju=zz(q,p,"mainPlaylistDownloadStateEntity");W=[W,Ju];Ju=g.f(G);for(var cj=Ju.next();!cj.done;cj=Ju.next())W.push(zz(q,cj.value,"mainPlaylistVideoEntity"));C&&W.push(zz(q,C,"ytMainChannelEntity"));return g.uO.all(W)}),4);
case 4:g.ij(B,3);break;case 2:throw g.M5(B),Oz("PES failure for playlist"),Error("PES failure for playlist");case 3:return B.return({mainPlaylistEntity:H,za5:C,Y5s:G})}})},Fiw=function(A,n){return{id:A,
channelId:n.channelId,title:n.title,avatar:n.thumbnail}},WiK=function(A){var n=[],O=A.videos;
O&&O.length>0&&n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:O[0].offlineVideoData.thumbnail}}});if((A=A.additionalMetadadatas)&&A.length>0)for(A=g.f(A),O=A.next();!O.done;O=A.next()){var L=O.value.offlineBundleItemPlaylistData,J=void 0;O=(J=L)==null?void 0:J.style;J=void 0;L={collageThumbnail:{coverThumbnail:(J=L)==null?void 0:J.coverThumbnail}};switch(O){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:L});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:L});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:L});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":n.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:L})}}return n},eOd=function(A){switch(A.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},hOW=function(A,n,O){n={offlineVideoData:n,
playlistId:O};if(A=g.h(A.actionMetadata,ouV))n.maximumDownloadQuality=A.maximumDownloadQuality;return{mainVideoEntityActionMetadata:n}},XND=function(A,n,O){this.U=A;
this.UN=n;this.C=O},nwd=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m,T;
return g.P(function(K){switch(K.U){case 1:return O=Gv(n),L=g.DP(n.entityKey),J=L.entityId,S=g.h(n.actionMetadata,Wf),G=!((N=S)==null?0:N.playlistId),g.EC(K,2),g.a(K,ZAc(A,J,void 0,(b=S)==null?void 0:b.offlineVideoData,G),4);case 4:g.ij(K,3);break;case 2:return t=g.M5(K),l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.UU&&t.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
K.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,l,D));case 3:Y=1;Y=Number(((m=n.actionMetadata)==null?void 0:m.priority)||0)+1;var C=(C=g.h(n.actionMetadata,Wf))?{playbackDataActionMetadata:{maximumDownloadQuality:C.maximumDownloadQuality}}:void 0;T=ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J,"playbackData",Y,Apw,C);return K.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,[T]))}})},OGN=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H;
return g.P(function(u){switch(u.U){case 1:return O=Gv(n),L=g.DP(n.entityKey),J=L.entityId,g.a(u,e2(A.U,n.entityKey,"mainVideoEntity"),2);case 2:S=u.J;if(!S){N=void 0;u.TV(3);break}return g.a(u,e2(A.U,S.downloadState,"mainVideoDownloadStateEntity"),4);case 4:N=u.J;case 3:G=N;if(!S||!G)return u.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.EC(u,5);return g.a(u,ZAc(A,J,G.addedTimestampMillis,(t=g.h(n.actionMetadata,Wf))==null?void 0:t.offlineVideoData),7);case 7:l=1;l=Number(((D=
n.actionMetadata)==null?void 0:D.priority)||0)+1;b=ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",J,"playbackData",l,Apw);g.ij(u,6);break;case 5:Y=g.M5(u);if(!(Y instanceof Error&&Y.message==="No data")){if(Y instanceof Error&&Y.message==="Empty response body")Oz(Y.message);else return m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.UU&&Y.type==="QUOTA_EXCEEDED"&&(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),u.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,m,T));u.TV(6);break}return g.a(u,Md(A.U,J),9);case 9:K=u.J;C=g.h(n.actionMetadata,Wf);if(H=(p=C)==null?void 0:p.playlistId)K.playlistId=H;K.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.a(u,Cs(J,A.U,n,A.C,K),6);case 6:return u.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,b?[b]:void 0))}})},Lur=function(A,n){var O,L,J,S,N,G,b,t,l,D;
return g.P(function(Y){switch(Y.U){case 1:return O=Gv(n),g.EC(Y,2),L=g.DP(n.entityKey).entityId,L==="!*$_ALL_ENTITIES_!*$"?g.a(Y,vld(A.U,n,A.C,(l=n.actionMetadata)==null?void 0:(D=l.offlineLoggingData)==null?void 0:D.offlineDeleteReason),5):g.a(Y,Md(A.U,L),6);case 6:J=Y.J;S=g.h(n.actionMetadata,Wf);if(G=(N=S)==null?void 0:N.playlistId)J.playlistId=G;J.offlineDeleteReason=(b=n.actionMetadata)==null?void 0:(t=b.offlineLoggingData)==null?void 0:t.offlineDeleteReason;return g.a(Y,Cs(L,A.U,n,A.C,J),7);
case 7:if(!A.UN.D("woffle_enable_main_downloads_library")){Y.TV(5);break}return g.a(Y,qbL(A.U,n.entityKey),5);case 5:g.ij(Y,3);break;case 2:return g.M5(Y),Y.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},ZAc=function(A,n,O,L,J){var S,N,G,b,t,l;
return g.P(function(D){switch(D.U){case 1:if(S=L){D.TV(2);break}return g.a(D,O8R([n]),3);case 3:N=D.J,S=N[0];case 2:return g.a(D,Jp6(A,S,O,J),4);case 4:G=D.J;b=G.mainVideoEntity;t=G.channelEntity;g.EC(D,5);var Y=Tv(b.thumbnail),m=Tv(t.avatar);return g.a(D,Ez(Y.concat(m)),7);case 7:g.ij(D,0);break;case 5:l=g.M5(D),l instanceof Error&&l.message==="Failed to fetch"&&Oz(l.message),g.Kx(D)}})},Jp6=function(A,n,O,L){var J,S,N,G,b,t,l,D,Y,m,T,K,C;
return g.P(function(p){switch(p.U){case 1:O||(O=Date.now().toString());S=(J=n.channel)==null?void 0:J.offlineChannelData;N={id:g.YU(n.videoId,"ytMainChannelEntity"),channelId:S.channelId,title:S.title,avatar:S.thumbnail};G={key:g.YU(n.videoId,"mainVideoDownloadStateEntity"),playbackData:g.YU(n.videoId,"playbackData"),addedTimestampMillis:O,videoDownloadContextEntity:g.YU(n.videoId,"videoDownloadContextEntity")};b={key:g.YU(n.videoId,"videoPlaybackPositionEntity"),videoId:n.videoId,lastPlaybackPositionSeconds:"0"};
A.UN.D("html5_offline_playback_position_sync")&&(t={playbackPosition:b.key});l=g.YU(n.videoId,"mainVideoEntity");D={key:l,videoId:n.videoId,title:n.title,thumbnail:n.thumbnail,localizedStrings:{viewCount:n.shortViewCountText},userState:t,lengthSeconds:n.lengthSeconds?Number(n.lengthSeconds):void 0,publishedTimestampMillis:n.publishedTimestamp?(Number(n.publishedTimestamp)*1E3).toString():void 0,formattedDescription:n.description,owner:N.id,downloadState:G.key};if(!A.UN.D("woffle_enable_main_downloads_library")||
!L){p.TV(2);break}return g.a(p,zTw(A.U,[l]),3);case 3:if(T=p.J)Y=T.mainDownloadsLibraryEntity,m=T.mainDownloadsListEntity;case 2:return C=glc,K={key:g.YU(n.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.kN(G,C,K),g.a(p,wT(A.U,{mode:"readwrite",iA:!0},function(H){var u=zz(H,N,"ytMainChannelEntity"),I=zz(H,G,"mainVideoDownloadStateEntity"),B=zz(H,D,"mainVideoEntity");u=[u,I,B];A.UN.D("html5_offline_playback_position_sync")&&(I=zz(H,b,"videoPlaybackPositionEntity"),
u.push(I));Y&&(I=zz(H,Y,"mainDownloadsLibraryEntity"),u.push(I));m&&(I=zz(H,m,"mainDownloadsListEntity"),u.push(I));K&&(H=zz(H,K,"downloadStatusEntity"),u.push(H));return g.uO.all(u)}),4);
case 4:return p.return({mainVideoEntity:D,channelEntity:N})}})},S9h=function(A,n,O){this.U=A;
this.UN=n;this.C=O},cpW=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I,B,q,W,Ju,cj,Au,z,F;
return g.P(function(x){switch(x.U){case 1:return O=Gv(n),L=[],g.a(x,$y.getInstance(),2);case 2:J=x.J;if(!J){x.TV(3);break}return g.a(x,J.get("sdois"),4);case 4:return S=x.J,g.a(x,(G=J)==null?void 0:G.get("lmqf"),5);case 5:N=x.J;case 3:g.EC(x,6);if(S===void 0)throw Error("prefStorage or opt-in state is undefined");b=[];if(S){x.TV(8);break}return g.a(x,hT3(A.U),9);case 9:b=x.J,b.reverse();case 8:if(!b.length){x.TV(10);break}t=g.f(b);l=t.next();case 11:if(l.done){x.TV(10);break}D=l.value;if(!D){x.TV(12);
break}Y=g.DP(D).entityId;return g.a(x,Md(A.U,Y),14);case 14:return m=x.J,m.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.a(x,Cs(Y,A.U,{entityKey:D,actionType:n.actionType},A.C,m),12);case 12:l=t.next();x.TV(11);break;case 10:return g.a(x,cTV(S,(T=N)!=null?T:"SD"),16);case 16:return K=x.J,g.a(x,B0w(K),17);case 17:C=RTc(K);if(!A.UN.D("woffle_enable_main_downloads_library")){x.TV(18);break}if(S){x.TV(19);break}return g.a(x,qbL(A.U,g.uW),19);case 19:return g.a(x,olp(A.U,[g.uW]),18);
case 18:if((p=C)==null?0:p.length)for(H=g.f(C),u=H.next();!u.done;u=H.next())if(B=I=u.value,q=B.actionType,W=B.entityKey,Ju=B.actionMetadata,q&&W&&Ju&&!g.h(Ju,NYV)){q==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Ju.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(cj=g.h(I.actionMetadata,Wf))cj.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",I.actionMetadata=Object.assign({},I.actionMetadata,{mainVideoEntityActionMetadata:cj});L.push(I)}g.ij(x,7);break;
case 6:return Au=g.M5(x),z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Au instanceof g.UU&&Au.type==="QUOTA_EXCEEDED"&&(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),x.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,z,F));case 7:return x.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,L))}})},GUr=function(){qd.apply(this,arguments);
this.X="mainVideoEntity"},bGL=function(A,n,O){n=n===void 0?43200:n;
O=O===void 0?!0:O;var L=L===void 0?!1:L;var J,S,N;return g.P(function(G){switch(G.U){case 1:if(!A.Z.Ab())return G.return([]);J=[];g.EC(G,2);return g.a(G,S8X(n,O,L),4);case 4:J=G.J;g.ij(G,3);break;case 2:S=g.M5(G),S instanceof Error&&S.message==="No data"||S instanceof Error&&S.message==="Empty response body"&&Oz(S.message);case 3:return N=vuR(A,J,O,"mainPlaylistEntity"),G.return(N)}})},t8c=function(A,n,O,L){L=L===void 0?!1:L;
var J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H;return g.P(function(u){switch(u.U){case 1:return J=[],g.a(u,NKN(),2);case 2:return(S=u.J)||L?g.a(u,GcL(n,O),3):u.return([]);case 3:N=u.J;if((G=N)==null||!G.length)return u.return([]);b={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};t=g.f(N);l=t.next();case 4:if(l.done){u.TV(6);break}Y=D=l.value;m=Y.actionType;T=Y.entityKey;K=Y.actionMetadata;if(!(m&&T&&K)||g.h(K,NYV)){u.TV(5);break}m==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(K.offlineLoggingData=
b);C=g.DP(T);p=C.entityId;return g.a(u,k7(A,[p],"mainVideoEntity",m,K),8);case 8:H=u.J,J=J.concat(H);case 5:l=t.next();u.TV(4);break;case 6:return u.return(J)}})},lIh=function(A,n){this.U=A;
this.C=n},Y93=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p;
return g.P(function(H){switch(H.U){case 1:return O=Gv(n),L=g.DP(n.entityKey),J=L.entityId,S=[],g.EC(H,2),g.a(H,Dph(A,J),4);case 4:S=H.J;if((N=S)==null||!N.length){H.TV(5);break}return g.a(H,FDh(A.U,n.entityKey),5);case 5:g.ij(H,3);break;case 2:return G=g.M5(H),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.UU&&G.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
H.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,b,t));case 3:return l=[],g.a(H,j$N(A.U,"musicTrack",S),7);case 7:S=H.J;if(S.length)for(D=g.f(S),Y=D.next();!Y.done;Y=D.next())if(m=Y.value,T=m.offlineVideoData,K=void 0,(K=T)==null?0:K.videoId)C=void 0,p=Number(((C=n.actionMetadata)==null?void 0:C.priority)||0)+1,l.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T.videoId,"musicTrack",p,eq,sz(n,T,J)));return H.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,l))}})},
mpw=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I,B,q,W,Ju,cj,Au,z,F,x,k,ZU,CW,nW,sC,e5,LW,dd,M,U,r,y,v,OC,S5,N5,Q,lj,dR,bj,aa,YV,RL,YW,oa,vx,b3,aC,zH,lv,VG;
return g.P(function(Bx){switch(Bx.U){case 1:return O=Gv(n),L=n.entityKey,J=g.DP(L).entityId,S=[],N=!1,J==="!*$_ALL_ENTITIES_!*$"?(N=!0,g.a(Bx,FK(A.U,"musicAlbumRelease"),5)):g.a(Bx,e2(A.U,L,"musicAlbumRelease"),4);case 4:(G=Bx.J)&&S.push(G);Bx.TV(3);break;case 5:S=Bx.J;case 3:if((b=S)==null||!b.length)return Bx.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));if(N){t=[];l=g.f(S);for(D=l.next();!D.done;D=l.next())Y=D.value,m=g.DP(Y.id).entityId,t.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
m,"musicAlbumRelease",0,eq));return Bx.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,t))}T=[];K=S[0];C=void 0;if(!K.downloadMetadata){Bx.TV(6);break}return g.a(Bx,e2(A.U,K.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:p=Bx.J,C=Number((u=(H=p)==null?void 0:H.addedTimestampMillis)!=null?u:"0")/1E3;case 6:return g.EC(Bx,8),g.a(Bx,Dph(A,J,(I=C)==null?void 0:I.toString()),10);case 10:T=Bx.J;g.ij(Bx,9);break;case 8:B=g.M5(Bx);if(!(B instanceof Error&&B.message===
"No data")){if(B instanceof Error&&B.message==="Empty response body")Oz(B.message);else return q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.UU&&B.type==="QUOTA_EXCEEDED"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Bx.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,q,W));Bx.TV(9);break}return g.a(Bx,Uz(J,"musicAlbumRelease",A.U,
n,A.C),9);case 9:Ju=[];cj=new Map;if((Au=T)==null?0:Au.length)for(z=g.f(T),F=z.next();!F.done;F=z.next())x=F.value,k=x.offlineVideoData,ZU=void 0,((ZU=k)==null?0:ZU.videoId)&&cj.set(k.videoId,k);CW=new Map;nW=[];if((sC=K)==null?0:(e5=sC.tracks)==null?0:e5.length)for(LW=g.f(K.tracks),dd=LW.next();!dd.done;dd=LW.next())if(M=dd.value,U=g.DP(M).entityId)cj.has(U)?(CW.set(U,cj.get(U)),cj.delete(U)):nW.push(U);y=Number(((r=n.actionMetadata)==null?void 0:r.priority)||0)+1;v=g.f(cj.entries());for(OC=v.next();!OC.done;OC=
v.next())S5=OC.value,N5=g.f(S5),Q=N5.next().value,lj=N5.next().value,dR=Q,bj=lj,Ju.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",dR,"musicTrack",y,eq,sz(n,bj)));aa=g.f(CW.entries());for(YV=aa.next();!YV.done;YV=aa.next())RL=YV.value,YW=g.f(RL),oa=YW.next().value,vx=YW.next().value,b3=oa,aC=vx,Ju.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",b3,"musicTrack",y,eq,sz(n,aC)));zH=g.f(nW);for(lv=zH.next();!lv.done;lv=zH.next())VG=lv.value,Ju.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",VG,
"musicTrack",0,eq));return Bx.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,Ju))}})},TYD=function(A,n){var O,L;
return g.P(function(J){switch(J.U){case 1:return O=Gv(n),g.EC(J,2),L=g.DP(n.entityKey).entityId,L==="!*$_ALL_ENTITIES_!*$"?g.a(J,Hf(A.U,n,A.C),5):g.a(J,Uz(L,"musicAlbumRelease",A.U,n,A.C),6);case 6:return g.a(J,X0W(A.U,n.entityKey),5);case 5:g.ij(J,3);break;case 2:return g.M5(J),J.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},Dph=function(A,n,O){var L,J,S;
return g.P(function(N){switch(N.U){case 1:return g.a(N,L6R([n]),2);case 2:return L=N.J,g.a(N,dpw(A,L[0],O),3);case 3:return J=N.J,S=Tv(J.thumbnailDetails),g.a(N,Ez(S),4);case 4:return N.return(L[0].videos)}})},dpw=function(A,n,O){var L,J,S,N,G,b,t,l,D,Y,m,T,K,C;
return g.P(function(p){if(p.U==1){L=n.additionalMetadadatas;J=void 0;if(L&&L.length>0)for(S=g.f(L),N=S.next();!N.done;N=S.next())if(G=N.value,G.offlineMusicPlaylistData){J=G.offlineMusicPlaylistData;break}b=n.playlistId;t=ZnX(n);l=t.rl;D=t.e5;Y=O?(Number(O)*1E3).toString():Date.now().toString();m=n.lastModifiedTimestamp?(Number(n.lastModifiedTimestamp)*1E3).toString():"0";T={id:g.YU(b,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:D,lastModifiedTimestampMillis:m,addedTimestampMillis:Y,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};K={id:g.YU(b,"musicAlbumRelease"),title:n.title,audioPlaylistId:b,trackCount:n.totalVideoCount,tracks:l,downloadMetadata:T.id};J&&(K.thumbnailDetails=(C=J.albumHqThumbnail)!=null?C:J.albumArtistThumbnail,K.artistDisplayName=J.albumArtistDisplayName,K.releaseDate=J.albumReleaseDate,K.contentRating={explicitType:J.albumReleaseExplicitType},K.releaseType=J.albumReleaseType);return g.a(p,wT(A.U,{mode:"readwrite",iA:!0},function(H){var u=zz(H,K,"musicAlbumRelease");
H=zz(H,T,"musicAlbumReleaseDownloadMetadataEntity");return g.uO.all([u,H])}),2)}return p.return(K)})},xpp=function(A,n){this.U=A;
this.C=n},Kuw=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p;
return g.P(function(H){switch(H.U){case 1:return O=Gv(n),L=g.DP(n.entityKey),J=L.entityId,S=[],g.EC(H,2),g.a(H,fIW(A,J),4);case 4:S=H.J;if((N=S)==null||!N.length){H.TV(5);break}return g.a(H,FDh(A.U,n.entityKey),5);case 5:g.ij(H,3);break;case 2:return G=g.M5(H),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.UU&&G.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
H.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,b,t));case 3:return l=[],g.a(H,j$N(A.U,"musicTrack",S),7);case 7:S=H.J;if(S.length)for(D=g.f(S),Y=D.next();!Y.done;Y=D.next())if(m=Y.value,T=m.offlineVideoData,K=void 0,(K=T)==null?0:K.videoId)C=void 0,p=Number(((C=n.actionMetadata)==null?void 0:C.priority)||0)+1,l.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T.videoId,"musicTrack",p,Fy,sz(n,T,J)));return H.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,l))}})},
Ewh=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I,B,q,W,Ju,cj,Au,z,F,x,k,ZU,CW,nW,sC,e5,LW,dd,M,U,r,y,v,OC,S5,N5,Q,lj,dR,bj,aa,YV,RL,YW,oa,vx,b3,aC,zH,lv,VG,Bx,Ru,KK,DO,rS,Du,ak,yg,Ip,UI,Fo,h2;
return g.P(function(Jd){switch(Jd.U){case 1:return O=Gv(n),L=n.entityKey,J=g.DP(L).entityId,S=[],N=!1,J==="!*$_ALL_ENTITIES_!*$"?(N=!0,g.a(Jd,FK(A.U,"musicPlaylist"),5)):g.a(Jd,e2(A.U,L,"musicPlaylist"),4);case 4:(G=Jd.J)&&S.push(G);Jd.TV(3);break;case 5:S=Jd.J;case 3:if((b=S)==null||!b.length)return Jd.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));t=g.h(n.actionMetadata,ATK);D=(l=t)==null?void 0:l.autoSync;Y=[];T=m=!0;K=!1;C=void 0;if(!N&&D===!1){Jd.TV(6);break}g.EC(Jd,7);return g.a(Jd,
b8h(0,!!D,!0,S),9);case 9:Y=Jd.J;g.ij(Jd,8);break;case 7:p=g.M5(Jd);if(!(p instanceof Error&&p.message==="No data")){p instanceof Error&&p.message==="Empty response body"&&Oz(p.message);Jd.TV(8);break}return J==="!*$_ALL_ENTITIES_!*$"?g.a(Jd,Hf(A.U,n,A.C),8):g.a(Jd,Uz(J,"musicPlaylist",A.U,n,A.C),8);case 8:if(!Y.length||!N&&Y[0].playlistId!==J)return Jd.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));case 6:if(N){H=[];u=g.f(Y);for(I=u.next();!I.done;I=u.next())B=I.value,B.upToDate||
D&&!B.shouldAutoSyncMetadata||!B.playlistId||(q={autoSync:D},H.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",B.playlistId,"musicPlaylist",0,Fy,{musicPlaylistEntityActionMetadata:q})));return Jd.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,H))}Y.length&&(W=Y[0],K=!!W.upToDate,D&&(m=(Ju=W.shouldAutoSyncMetadata)!=null?Ju:!0,T=(cj=W.shouldAutoSyncVideos)!=null?cj:!0,W.checkInSeconds&&(C=W.checkInSeconds)));if(K||!m)return Jd.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O));Au=[];z=S[0];F=void 0;if(!z.downloadMetadata){Jd.TV(15);break}return g.a(Jd,e2(A.U,z.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:x=Jd.J,F=Number((ZU=(k=x)==null?void 0:k.addedTimestampMillis)!=null?ZU:"0")/1E3;case 15:return g.EC(Jd,17),g.a(Jd,fIW(A,J,(CW=F)==null?void 0:CW.toString(),C),19);case 19:Au=Jd.J;g.ij(Jd,18);break;case 17:nW=g.M5(Jd);if(!(nW instanceof Error&&nW.message==="No data")){if(nW instanceof Error&&nW.message==="Empty response body")Oz(nW.message);else return sC=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e5="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",nW instanceof g.UU&&nW.type==="QUOTA_EXCEEDED"&&(sC="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",e5="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Jd.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,sC,e5));Jd.TV(18);break}return g.a(Jd,Uz(J,"musicPlaylist",A.U,n,A.C),18);case 18:if(!T)return Jd.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O));LW=[];dd=new Map;if((M=Au)==null?0:M.length)for(U=g.f(Au),r=U.next();!r.done;r=U.next())y=r.value,v=y.offlineVideoData,OC=void 0,((OC=v)==null?0:OC.videoId)&&dd.set(v.videoId,v);S5=new Map;N5=[];if((Q=z)==null?0:(lj=Q.tracks)==null?0:lj.length)for(dR=g.f(z.tracks),bj=dR.next();!bj.done;bj=dR.next())if(aa=bj.value,YV=g.DP(aa).entityId)dd.has(YV)?(S5.set(YV,dd.get(YV)),dd.delete(YV)):N5.push(YV);YW=Number(((RL=n.actionMetadata)==null?void 0:RL.priority)||0)+1;oa=g.f(dd.entries());for(vx=oa.next();!vx.done;vx=
oa.next())b3=vx.value,aC=g.f(b3),zH=aC.next().value,lv=aC.next().value,VG=zH,Bx=lv,LW.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",VG,"musicTrack",YW,Fy,sz(n,Bx)));Ru=g.f(S5.entries());for(KK=Ru.next();!KK.done;KK=Ru.next())DO=KK.value,rS=g.f(DO),Du=rS.next().value,ak=rS.next().value,yg=Du,Ip=ak,LW.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",yg,"musicTrack",YW,Fy,sz(n,Ip)));UI=g.f(N5);for(Fo=UI.next();!Fo.done;Fo=UI.next())h2=Fo.value,LW.push(ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
h2,"musicTrack",0,Fy));return Jd.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,LW))}})},CxR=function(A,n){var O,L;
return g.P(function(J){switch(J.U){case 1:return O=Gv(n),g.EC(J,2),L=g.DP(n.entityKey).entityId,L==="!*$_ALL_ENTITIES_!*$"?g.a(J,Hf(A.U,n,A.C),5):g.a(J,Uz(L,"musicPlaylist",A.U,n,A.C),6);case 6:return g.a(J,X0W(A.U,n.entityKey),5);case 5:g.ij(J,3);break;case 2:return g.M5(J),J.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},fIW=function(A,n,O,L){var J,S,N;
return g.P(function(G){switch(G.U){case 1:return g.a(G,L6R([n]),2);case 2:return J=G.J,g.a(G,iGw(A,J[0],O,L),3);case 3:return S=G.J,N=Tv(S.thumbnailDetails),g.a(G,Ez(N),4);case 4:return G.return(J[0].videos)}})},iGw=function(A,n,O,L){var J,S,N,G,b,t,l,D,Y;
return g.P(function(m){return m.U==1?(J=n.playlistId,S=ZnX(n),N=S.rl,G=S.e5,b=O?(Number(O)*1E3).toString():Date.now().toString(),t=n.lastModifiedTimestamp?(Number(n.lastModifiedTimestamp)*1E3).toString():"0",l={id:g.YU(J,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:G,lastModifiedTimestampMillis:t,addedTimestampMillis:b,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},D={id:g.YU(J,"musicPlaylist"),title:n.title,playlistId:J,thumbnailDetails:n.thumbnail,visibility:M8p(n),trackCount:n.totalVideoCount,
tracks:N,downloadMetadata:l.id},L&&(((Y=D)==null?0:Y.entityMetadata)?D.entityMetadata.nextAutoRefreshIntervalSeconds=String(L):D&&(D.entityMetadata={nextAutoRefreshIntervalSeconds:String(L)})),g.a(m,wT(A.U,{mode:"readwrite",iA:!0},function(T){var K=zz(T,D,"musicPlaylist");T=zz(T,l,"musicPlaylistDownloadMetadataEntity");return g.uO.all([K,T])}),2)):m.return(D)})},M8p=function(A){switch(A.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},pyW=function(A,n){this.U=A;
this.C=n},gw6=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m,T;
return g.P(function(K){switch(K.U){case 1:return O=Gv(n),L=g.DP(n.entityKey),J=L.entityId,S=g.h(n.actionMetadata,UpK),g.EC(K,2),g.a(K,HGW(A,J,void 0,(N=S)==null?void 0:N.track,(G=S)==null?void 0:G.albumRelease),4);case 4:if((b=S)==null?0:b.playlistId){K.TV(5);break}return g.a(K,FDh(A.U,n.entityKey),5);case 5:g.ij(K,3);break;case 2:return t=g.M5(K),l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.UU&&t.type==="QUOTA_EXCEEDED"&&
(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),K.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,l,D));case 3:m=Number(((Y=n.actionMetadata)==null?void 0:Y.priority)||0)+1;var C=(C=g.h(n.actionMetadata,UpK))?{playbackDataActionMetadata:{maximumDownloadQuality:C.maximumDownloadQuality}}:void 0;T=ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J,"playbackData",m,scw,C);return K.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O,[T]))}})},jcD=function(A,n){var O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C;
return g.P(function(p){switch(p.U){case 1:return O=Gv(n),L=g.DP(n.entityKey),J=L.entityId,g.a(p,e2(A.U,n.entityKey,"musicTrack"),2);case 2:S=p.J;if(!S){N=void 0;p.TV(3);break}return g.a(p,e2(A.U,S.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:N=p.J;case 3:G=N;if(!S||!G)return p.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));t=g.h(n.actionMetadata,UpK);g.EC(p,5);return g.a(p,HGW(A,J,G.addedTimestampMillis,(l=t)==null?void 0:l.track,(D=t)==null?void 0:D.albumRelease),
7);case 7:m=Number(((Y=n.actionMetadata)==null?void 0:Y.priority)||0)+1;b=ue("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",J,"playbackData",m,scw);g.ij(p,6);break;case 5:T=g.M5(p);if(!(T instanceof Error&&T.message==="No data")){if(T instanceof Error&&T.message==="Empty response body")Oz(T.message);else return K="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.UU&&T.type==="QUOTA_EXCEEDED"&&(K="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),p.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,K,C));p.TV(6);break}return g.a(p,ps(J,A.U,n,A.C),6);case 6:return p.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,b?[b]:void 0))}})},rpW=function(A,n){var O,L;
return g.P(function(J){switch(J.U){case 1:return O=Gv(n),g.EC(J,2),L=g.DP(n.entityKey).entityId,L==="!*$_ALL_ENTITIES_!*$"?g.a(J,Hf(A.U,n,A.C),5):g.a(J,ps(L,A.U,n,A.C),6);case 6:return g.a(J,X0W(A.U,n.entityKey),5);case 5:g.ij(J,3);break;case 2:return g.M5(J),J.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new Pf("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},HGW=function(A,n,O,L,J){var S,N,G,b,t,l;
return g.P(function(D){switch(D.U){case 1:if(S=L){D.TV(2);break}return g.a(D,O8R([n]),3);case 3:N=D.J,G=N[0],S=eTc(G);case 2:return g.a(D,aIK(A,S,n,J,O),4);case 4:b=D.J;t=b.musicTrackEntity;l=b.J8;var Y=Tv(t.thumbnailDetails),m=[];l&&(m=Tv(l.thumbnailDetails));return g.a(D,Ez(Y.concat(m)),0)}})},aIK=function(A,n,O,L,J){var S;
return g.P(function(N){return N.U==1?(J||(J=Date.now().toString()),S={id:g.YU(O,"musicTrackDownloadMetadataEntity"),playbackData:g.YU(O,"playbackData"),addedTimestampMillis:J,videoDownloadContextEntity:g.YU(O,"videoDownloadContextEntity")},L&&(n.albumRelease=L.id),g.a(N,wT(A.U,{mode:"readwrite",iA:!0},function(G){var b=[],t=zz(G,S,"musicTrackDownloadMetadataEntity");b.push(t);t=zz(G,n,"musicTrack");b.push(t);L&&(G=zz(G,L,"musicAlbumRelease"),b.push(G));return g.uO.all(b)}),2)):N.U!=3?g.a(N,DD(O,"musicTrackDownloadMetadataEntity",
A.U,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):N.return({musicTrackEntity:n,
J8:L})})},Xy=function(){qd.apply(this,arguments);
this.X="musicTrack"},uwR=function(A,n,O){n=n===void 0?43200:n;
O=O===void 0?!0:O;var L=L===void 0?!1:L;var J,S;return g.P(function(N){switch(N.U){case 1:if(!A.Z.Ab())return N.return([]);J=[];g.EC(N,2);return g.a(N,b8h(n,O,L),4);case 4:J=N.J;g.ij(N,3);break;case 2:g.M5(N);case 3:return S=vuR(A,J,O,"musicPlaylist"),N.return(S)}})},Px3=function(){g.Ma.apply(this,arguments);
var A=this;this.events=new g.Vr(this);this.UN=this.player.K();this.uo={xUY:function(){return A.U},
xu:function(){return A.xu()},
E8:function(n){return A.E8(n)}}},yph=function(A){var n;
A=g.h((n=A.getWatchNextResponse())==null?void 0:n.currentVideoEndpoint,g.e3);if(A==null?0:A.playlistId)var O=A.playlistId;return O},IIh=function(A,n){var O,L,J,S;
return g.P(function(N){if(N.U==1){O=n.clientPlaybackNonce;L={cpn:O,offlineSourceVisualElement:g.jO(n.Zu||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};n.J&&(L.videoFmt=Number(n.J.itag));n.L&&(L.audioFmt=Number(n.L.itag));if((J=yph(n))&&n.videoId){var G=n.videoId;G=J!=="PPSV"?Promise.resolve(!1):A.U.X7(G);N=g.a(N,G,3)}else N=N.TV(2);return N}N.U!=2&&(S=N.J)&&(L.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");A.J=O;g.f4("offlinePlaybackStarted",L);g.Kx(N)})};
g.pf.prototype.EE=g.Lx(45,function(A){return this.app.EE(A)});
g.K6.prototype.EE=g.Lx(44,function(A){return g.E4(this,9,A)});
g.d(Ie,yT);g.GY.Object.defineProperties(Ie.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.U.entityMetadata},
set:function(A){this.U.entityMetadata=A}}});
g.d(afW,Ie);afW.prototype.J=function(){return[]};
g.d(u3N,Ie);u3N.prototype.J=function(){return[]};
g.d(P63,Ie);P63.prototype.J=function(){return[]};
g.d(yRr,Ie);yRr.prototype.J=function(){return[]};
g.d(If6,Ie);If6.prototype.J=function(){var A=[];this.U.alternateChannel&&A.push(this.U.alternateChannel);this.U.alternateChannelList&&A.push.apply(A,g.E(this.U.alternateChannelList));this.U.oneofChannelEntity&&A.push(this.U.oneofChannelEntity);return[].concat(g.E(new Set(A)))};
g.d(QVc,Ie);QVc.prototype.J=function(){var A=[];this.U.entryCollection&&A.push(this.U.entryCollection);return[].concat(g.E(new Set(A)))};
g.d($8N,yT);$8N.prototype.J=function(){var A=[];this.U.video&&A.push(this.U.video);return[].concat(g.E(new Set(A)))};
g.d(vIh,Ie);vIh.prototype.J=function(){var A=[];this.U.parentPlaylist&&A.push(this.U.parentPlaylist);if(this.U.entries)for(var n=g.f(this.U.entries),O=n.next();!O.done;O=n.next())A.push.apply(A,g.E((new $8N(O.value)).J()));return[].concat(g.E(new Set(A)))};
g.d(BJW,Ie);BJW.prototype.J=function(){var A=[];this.U.descriptionEntity&&A.push(this.U.descriptionEntity);this.U.creators&&A.push.apply(A,g.E(this.U.creators));this.U.theBiggestFan&&A.push(this.U.theBiggestFan);return[].concat(g.E(new Set(A)))};
g.d(Vep,Ie);Vep.prototype.J=function(){return[]};
g.d(RPD,Ie);RPD.prototype.J=function(){return[]};
g.d(hPw,Ie);hPw.prototype.J=function(){return[]};
g.d(zP6,Ie);zP6.prototype.J=function(){return[]};
g.d(oIN,Ie);oIN.prototype.J=function(){return[]};
g.d(qIp,Ie);qIp.prototype.J=function(){return[]};
g.d(kLL,Ie);kLL.prototype.J=function(){return[]};
g.d(wvc,Ie);wvc.prototype.J=function(){return[]};
g.d(WjK,Ie);WjK.prototype.J=function(){return[]};
g.d(ePX,Ie);ePX.prototype.J=function(){var A=[];this.U.downloadsList&&A.push(this.U.downloadsList);this.U.smartDownloadsList&&A.push(this.U.smartDownloadsList);this.U.recommendedDownloadsList&&A.push(this.U.recommendedDownloadsList);this.U.refresh&&A.push(this.U.refresh);return[].concat(g.E(new Set(A)))};
g.d(Fjw,yT);Fjw.prototype.J=function(){var A=[];this.U.video&&A.push(this.U.video);this.U.playlist&&A.push(this.U.playlist);this.U.videoItem&&A.push(this.U.videoItem);this.U.playlistItem&&A.push(this.U.playlistItem);return[].concat(g.E(new Set(A)))};
g.d(XvR,Ie);XvR.prototype.J=function(){var A=[];this.U.refresh&&A.push(this.U.refresh);if(this.U.downloads)for(var n=g.f(this.U.downloads),O=n.next();!O.done;O=n.next())A.push.apply(A,g.E((new Fjw(O.value)).J()));return[].concat(g.E(new Set(A)))};
g.d(ZT6,Ie);ZT6.prototype.J=function(){var A=[];this.U.localImageEntities&&A.push.apply(A,g.E(this.U.localImageEntities));return[].concat(g.E(new Set(A)))};
g.d(AIR,Ie);AIR.prototype.J=function(){var A=[];this.U.playbackData&&A.push(this.U.playbackData);this.U.localImageEntities&&A.push.apply(A,g.E(this.U.localImageEntities));this.U.videoDownloadContextEntity&&A.push(this.U.videoDownloadContextEntity);return[].concat(g.E(new Set(A)))};
g.d(naw,Ie);naw.prototype.J=function(){return[]};
g.d(OXV,Ie);OXV.prototype.J=function(){var A=[];this.U.fakeChildren&&A.push.apply(A,g.E(this.U.fakeChildren));return[].concat(g.E(new Set(A)))};
g.d(Lo3,Ie);Lo3.prototype.J=function(){var A=[];this.U.video&&A.push(this.U.video);this.U.playbackData&&A.push(this.U.playbackData);this.U.offlineVideoPolicy&&A.push(this.U.offlineVideoPolicy);return[].concat(g.E(new Set(A)))};
g.d(JIh,Ie);JIh.prototype.J=function(){return[]};
g.d(SD3,Ie);SD3.prototype.J=function(){var A=[];this.U.channelOwner&&A.push(this.U.channelOwner);this.U.videos&&A.push.apply(A,g.E(this.U.videos));this.U.collaboratorChannels&&A.push.apply(A,g.E(this.U.collaboratorChannels));this.U.downloadState&&A.push(this.U.downloadState);this.U.refresh&&A.push(this.U.refresh);return[].concat(g.E(new Set(A)))};
g.d(Nvr,Ie);Nvr.prototype.J=function(){var A=[];this.U.video&&A.push(this.U.video);this.U.channelContributor&&A.push(this.U.channelContributor);return[].concat(g.E(new Set(A)))};
g.d(cIw,yT);cIw.prototype.J=function(){var A=[];this.U.localImageEntities&&A.push.apply(A,g.E(this.U.localImageEntities));this.U.videoDownloadContextEntity&&A.push(this.U.videoDownloadContextEntity);return[].concat(g.E(new Set(A)))};
g.d(GQh,yT);GQh.prototype.J=function(){var A=[];this.U.recommendedVideoMetadata&&A.push.apply(A,g.E((new cIw(this.U.recommendedVideoMetadata)).J()));return[].concat(g.E(new Set(A)))};
g.d(bXW,yT);bXW.prototype.J=function(){var A=[];this.U.playbackPosition&&A.push(this.U.playbackPosition);return[].concat(g.E(new Set(A)))};
g.d(trL,Ie);trL.prototype.J=function(){var A=[];this.U.owner&&A.push(this.U.owner);this.U.downloadState&&A.push(this.U.downloadState);this.U.userState&&A.push.apply(A,g.E((new bXW(this.U.userState)).J()));this.U.additionalMetadata&&A.push.apply(A,g.E((new GQh(this.U.additionalMetadata)).J()));return[].concat(g.E(new Set(A)))};
g.d(l3V,Ie);l3V.prototype.J=function(){var A=[];this.U.userChannelDetails&&A.push(this.U.userChannelDetails);return[].concat(g.E(new Set(A)))};
g.d(DhN,Ie);DhN.prototype.J=function(){var A=[];this.U.channelOwner&&A.push(this.U.channelOwner);this.U.playbackPosition&&A.push(this.U.playbackPosition);this.U.localImageEntities&&A.push.apply(A,g.E(this.U.localImageEntities));this.U.downloadStatus&&A.push(this.U.downloadStatus);return[].concat(g.E(new Set(A)))};
g.d(YDK,Ie);YDK.prototype.J=function(){return[]};
g.d(mhp,Ie);mhp.prototype.J=function(){return[]};
g.d(TvN,Ie);TvN.prototype.J=function(){return[]};
g.d(dhK,Ie);dhK.prototype.J=function(){return[]};
g.d(xhh,Ie);xhh.prototype.J=function(){return[]};
g.d(f3p,Ie);f3p.prototype.J=function(){return[]};
g.d(Ko6,Ie);Ko6.prototype.J=function(){return[]};
g.d(EaW,Ie);EaW.prototype.J=function(){return[]};
g.d(C4p,Ie);C4p.prototype.J=function(){return[]};
g.d(iX3,Ie);iX3.prototype.J=function(){return[]};
g.d(MrX,Ie);MrX.prototype.J=function(){return[]};
g.d(pUw,Ie);pUw.prototype.J=function(){var A=[];this.U.trackDownloadMetadatas&&A.push.apply(A,g.E(this.U.trackDownloadMetadatas));return[].concat(g.E(new Set(A)))};
g.d(Uhw,Ie);
Uhw.prototype.J=function(){var A=[];this.U.downloadedTracks&&A.push.apply(A,g.E(this.U.downloadedTracks));this.U.smartDownloadedTracks&&A.push.apply(A,g.E(this.U.smartDownloadedTracks));this.U.downloadedEpisodes&&A.push.apply(A,g.E(this.U.downloadedEpisodes));this.U.downloadedAlbumReleases&&A.push.apply(A,g.E(this.U.downloadedAlbumReleases));this.U.smartDownloadedAlbumReleases&&A.push.apply(A,g.E(this.U.smartDownloadedAlbumReleases));this.U.downloadedPlaylists&&A.push.apply(A,g.E(this.U.downloadedPlaylists));this.U.smartDownloadedPlaylists&&
A.push.apply(A,g.E(this.U.smartDownloadedPlaylists));this.U.metadataOnlyTracks&&A.push.apply(A,g.E(this.U.metadataOnlyTracks));return[].concat(g.E(new Set(A)))};
g.d(HXV,Ie);HXV.prototype.J=function(){var A=[];this.U.trackDownloadMetadatas&&A.push.apply(A,g.E(this.U.trackDownloadMetadatas));return[].concat(g.E(new Set(A)))};
g.d(sp6,Ie);sp6.prototype.J=function(){var A=[];this.U.playbackData&&A.push(this.U.playbackData);this.U.localImageEntities&&A.push.apply(A,g.E(this.U.localImageEntities));this.U.videoDownloadContextEntity&&A.push(this.U.videoDownloadContextEntity);return[].concat(g.E(new Set(A)))};
g.d(gaV,Ie);gaV.prototype.J=function(){var A=[];this.U.musicLibraryStatusEntity&&A.push(this.U.musicLibraryStatusEntity);this.U.primaryArtists&&A.push.apply(A,g.E(this.U.primaryArtists));this.U.details&&A.push(this.U.details);this.U.userDetails&&A.push(this.U.userDetails);this.U.tracks&&A.push.apply(A,g.E(this.U.tracks));this.U.share&&A.push(this.U.share);this.U.downloadMetadata&&A.push(this.U.downloadMetadata);this.U.refresh&&A.push(this.U.refresh);return[].concat(g.E(new Set(A)))};
g.d(jpD,Ie);jpD.prototype.J=function(){var A=[];this.U.albumRelease&&A.push(this.U.albumRelease);this.U.tracks&&A.push.apply(A,g.E(this.U.tracks));return[].concat(g.E(new Set(A)))};
g.d(rIr,Ie);rIr.prototype.J=function(){var A=[];this.U.albumRelease&&A.push(this.U.albumRelease);return[].concat(g.E(new Set(A)))};
g.d(a3p,Ie);a3p.prototype.J=function(){var A=[];this.U.details&&A.push(this.U.details);this.U.userDetails&&A.push(this.U.userDetails);return[].concat(g.E(new Set(A)))};
g.d(u4h,Ie);u4h.prototype.J=function(){var A=[];this.U.parentArtist&&A.push(this.U.parentArtist);return[].concat(g.E(new Set(A)))};
g.d(P4R,Ie);P4R.prototype.J=function(){var A=[];this.U.parentArtist&&A.push(this.U.parentArtist);return[].concat(g.E(new Set(A)))};
g.d(yId,Ie);yId.prototype.J=function(){return[]};
g.d(I3d,Ie);I3d.prototype.J=function(){return[]};
g.d(Qp6,yT);Qp6.prototype.J=function(){var A=[];this.U.creatorEntity&&A.push(this.U.creatorEntity);return[].concat(g.E(new Set(A)))};
g.d($hc,Ie);
$hc.prototype.J=function(){var A=[];this.U.tracks&&A.push.apply(A,g.E(this.U.tracks));this.U.refresh&&A.push(this.U.refresh);this.U.musicLibraryStatusEntity&&A.push(this.U.musicLibraryStatusEntity);this.U.details&&A.push(this.U.details);this.U.downloadMetadata&&A.push(this.U.downloadMetadata);this.U.sideloadMetadata&&A.push(this.U.sideloadMetadata);this.U.userDetails&&A.push(this.U.userDetails);this.U.entryCollection&&A.push(this.U.entryCollection);this.U.share&&A.push(this.U.share);this.U.podcastShowAdditionalMetadata&&A.push.apply(A,
g.E((new Qp6(this.U.podcastShowAdditionalMetadata)).J()));return[].concat(g.E(new Set(A)))};
g.d(vaV,Ie);vaV.prototype.J=function(){return[]};
g.d(BvW,Ie);
BvW.prototype.J=function(){var A=[];this.U.musicLibraryStatusEntity&&A.push(this.U.musicLibraryStatusEntity);this.U.artists&&A.push.apply(A,g.E(this.U.artists));this.U.audioModeVersion&&A.push(this.U.audioModeVersion);this.U.videoModeVersion&&A.push(this.U.videoModeVersion);this.U.userDetails&&A.push(this.U.userDetails);this.U.details&&A.push(this.U.details);this.U.albumRelease&&A.push(this.U.albumRelease);this.U.share&&A.push(this.U.share);this.U.libraryEdit&&A.push(this.U.libraryEdit);this.U.downloadMetadata&&
A.push(this.U.downloadMetadata);this.U.playbackPosition&&A.push(this.U.playbackPosition);this.U.lyrics&&A.push(this.U.lyrics);return[].concat(g.E(new Set(A)))};
g.d(Vr3,Ie);Vr3.prototype.J=function(){var A=[];this.U.parentTrack&&A.push(this.U.parentTrack);return[].concat(g.E(new Set(A)))};
g.d(RC6,Ie);RC6.prototype.J=function(){var A=[];this.U.parentTrack&&A.push(this.U.parentTrack);return[].concat(g.E(new Set(A)))};
g.d(hCN,Ie);hCN.prototype.J=function(){return[]};
g.d(zCp,Ie);zCp.prototype.J=function(){return[]};
g.d(oaW,Ie);oaW.prototype.J=function(){return[]};
g.d(qD3,Ie);qD3.prototype.J=function(){return[]};
g.d(kQp,Ie);kQp.prototype.J=function(){var A=[];this.U.transfer&&A.push(this.U.transfer);this.U.adsPlaybackData&&A.push.apply(A,g.E(this.U.adsPlaybackData));this.U.drmLicense&&A.push(this.U.drmLicense);this.U.offlineVideoPolicy&&A.push(this.U.offlineVideoPolicy);this.U.videoDownloadContextEntity&&A.push(this.U.videoDownloadContextEntity);return[].concat(g.E(new Set(A)))};
g.d(wUR,Ie);wUR.prototype.J=function(){return[]};
g.d(Woc,Ie);Woc.prototype.J=function(){var A=[];this.U.offlineVideoStreams&&A.push.apply(A,g.E(this.U.offlineVideoStreams));this.U.captionTrack&&A.push.apply(A,g.E(this.U.captionTrack));return[].concat(g.E(new Set(A)))};
g.d(eC6,Ie);eC6.prototype.J=function(){return[]};
g.d(FoN,Ie);FoN.prototype.J=function(){return[]};
g.d(XU3,Ie);XU3.prototype.J=function(){return[]};
g.d(ZXc,Ie);ZXc.prototype.J=function(){return[]};
g.d(AtR,Ie);AtR.prototype.J=function(){return[]};
g.d(n5w,Ie);n5w.prototype.J=function(){return[]};
g.d(OiN,Ie);OiN.prototype.J=function(){return[]};
g.d(LaN,Ie);LaN.prototype.J=function(){return[]};
g.d(Jtw,Ie);Jtw.prototype.J=function(){return[]};
g.d(S3r,Ie);S3r.prototype.J=function(){return[]};
g.d(NBc,Ie);NBc.prototype.J=function(){return[]};
g.d(ctK,Ie);ctK.prototype.J=function(){return[]};
g.d(GkX,Ie);GkX.prototype.J=function(){return[]};
g.d(bi6,Ie);bi6.prototype.J=function(){return[]};
g.d(tMc,Ie);tMc.prototype.J=function(){return[]};
g.d(low,Ie);low.prototype.J=function(){return[]};
g.d(DmL,Ie);DmL.prototype.J=function(){return[]};
var tIW=["browse","music/browse","unplugged/browse"],TKp=["offline/playlist_sync_check"],nQp=["offline"],lBd=["offline/offline_video_playback_position_sync"],Y8V=["offline/get_playback_data_entity"],QT;$y.getInstance=function(){return g.P(function(A){return A.return(new Promise(function(n){g.cu().then(function(O){O?($y.instance||($y.instance=new $y(O)),n($y.instance)):n(void 0)})}))})};
$y.prototype.get=function(A){var n=this,O,L,J;return g.P(function(S){if(S.U==1)return g.a(S,dmc(n.token),2);if(S.U!=3)return O=S.J,g.a(S,O.get("prefs",A),3);L=S.J;if(!L)return S.return();J=(0,g.Qs)();return L.expirationTimestampMs<=J?S.return():S.return(L.value)})};
$y.prototype.set=function(A,n,O){O=O===void 0?31536E3:O;var L=this,J,S,N;return g.P(function(G){if(G.U==1)return J=(0,g.Qs)(),S={key:A,value:n,expirationTimestampMs:J+O*1E3},g.a(G,dmc(L.token),2);N=G.J;return g.a(G,g.h3(N,"prefs",S),0)})};
$y.prototype.remove=function(A){var n=this,O;return g.P(function(L){if(L.U==1)return g.a(L,dmc(n.token),2);O=L.J;return g.a(L,O.delete("prefs",A),0)})};
g.d(va,g.OU);g.d(Ba,Cqc);Ba.prototype.C=function(A,n){n=MMd(n);A=(new TextEncoder).encode(JSON.stringify(A));return this.U.encrypt(A,n)};
Ba.prototype.J=function(A,n){if(!(A instanceof Uint8Array))throw xmV(1);var O=new TextDecoder;n=MMd(n);A=this.U.decrypt(A,n);return JSON.parse(O.decode(A))};
var p4D={accountLinkStatusEntity:hPw,booleanEntity:P63,buttonEntity:S3r,captionTrack:hCN,channelHandle:afW,commerceAcquisitionClientPayloadEntity:ctK,commerceCartListEntity:GkX,contextNoteFeedEntityPayload:u3N,continuationTokenEntity:JIh,downloadQualityPickerEntity:kLL,downloadsPageRefreshTokenEntity:WjK,downloadsPageViewConfigurationEntity:YDK,downloadStatusEntity:wvc,sfvAudioItemCurrentlyPlayingEntity:FoN,emojiFountainDataEntity:LaN,emojiCustomizationSetEntity:OiN,fakeChannel:If6,fakePlaylist:QVc,
fakePlaylistEntryCollection:vIh,fakeVideo:BJW,fakeVideoDescription:Vep,featuredProductsEntity:C4p,flowStateEntity:RPD,iconBadgeEntity:bi6,interstitialInteractionStateEntity:oIN,likeButtonAnimationEntity:mhp,liveChatPollStateEntity:qIp,liveReactionsDataEntity:Jtw,logoEntity:zP6,macroMarkerEntity:TvN,mainDownloadsLibraryEntity:ePX,mainDownloadsListEntity:XvR,mainPlaylistDownloadStateEntity:ZT6,mainPlaylistEntity:SD3,mainPlaylistVideoEntity:Nvr,mainVideoDownloadStateEntity:AIR,mainVideoEntity:trL,markersEngagementPanelSyncEntity:dhK,
markersVisibilityOverrideEntity:xhh,musicAlbumReleaseDetail:jpD,musicAlbumReleaseDownloadMetadataEntity:pUw,musicAlbumRelease:gaV,musicAlbumReleaseUserDetail:rIr,musicArtistDetail:u4h,musicArtist:a3p,musicArtistUserDetail:P4R,musicDownloadsLibraryEntity:Uhw,musicLibraryEdit:yId,musicLibraryStatusEntity:I3d,musicPlaylist:$hc,musicPlaylistDownloadMetadataEntity:HXV,musicShare:vaV,musicTrackDetail:Vr3,musicTrackDownloadMetadataEntity:sp6,musicTrack:BvW,musicTrackUserDetail:RC6,offlineOrchestrationActionWrapperEntity:zCp,
offlineVideoPolicy:oaW,offlineVideoStreams:qD3,offlineabilityEntity:naw,orchestrationWebSamplingEntity:OXV,pageHeaderEntity:AtR,pdpStateEntity:tMc,pinnedProductEntity:iX3,playbackData:kQp,playerStateEntity:f3p,quantityIncrementerEntity:low,refresh:wUR,saveToPlaylistListEntity:XU3,settingEntity:ZXc,stringEntity:yRr,suggestedFeedbackChipStateEntity:Ko6,transfer:Woc,trendingOfferEntity:MrX,videoDownloadContextEntity:eC6,videoOverviewAsyncDataEntity:DmL,videoPlaybackPositionEntity:NBc,votingEntity:n5w,
ytMainChannelEntity:l3V,youchatPendingResponseEntity:EaW,ytMainDownloadedVideoEntity:Lo3,ytMainVideoEntity:DhN};g.d(q3,Cqc);q3.prototype.C=function(A){return A};
q3.prototype.J=function(A){if(A instanceof Uint8Array)throw xmV(0);return A};
g.d(ky,g.V);ky.prototype.observe=function(A){var n=this;this.observers.push(A);return function(){var O=n.observers.indexOf(A);O>=0&&n.observers.splice(O,1)}};
ky.prototype.J=function(A){v5X(this,A.data)};
ky.prototype.h5=function(){this.channel.close()};
var zSV,VaN=new g.Ir("elementsCommand");var ie=new g.Ir("entityBatchUpdate");var glc=new g.Ir("downloadStatusEntity");var ouV=new g.Ir("mainPlaylistEntityActionMetadata");var Wf=new g.Ir("mainVideoEntityActionMetadata");var ATK=new g.Ir("musicPlaylistEntityActionMetadata");var UpK=new g.Ir("musicTrackEntityActionMetadata");var NYV=new g.Ir("localImageEntityActionMetadata");var yB=new g.Ir("playbackDataActionMetadata");var R76=new g.Ir("transferEntityActionMetadata");var H8d=new g.Ir("videoPlaybackPositionEntityActionMetadata");var Sbr;new g.i6;new g.i6;taL.prototype.request=function(A,n,O){n=n===void 0?{}:n;return this.locks.request(A,n,function(L){return O(L)})};var ns=g.vj.caches,AS,T06;Z1.prototype.open=function(A){return ns.open(YbV(A))};
Z1.prototype.has=function(A){return ns.has(YbV(A))};
Z1.prototype.delete=function(A){return ns.delete(YbV(A))};
Z1.prototype.match=function(A,n){var O=this,L,J,S,N,G,b;return g.P(function(t){switch(t.U){case 1:return g.a(t,O.keys(),2);case 2:L=t.J,J=g.f(L),S=J.next();case 3:if(S.done){t.TV(5);break}N=S.value;return g.a(t,O.open(N),6);case 6:return G=t.J,g.a(t,G.match(A,n),7);case 7:if(b=t.J)return t.return(b);S=J.next();t.TV(3);break;case 5:return t.return()}})};
g.d(DjV,Z1);DjV.prototype.keys=function(){var A,n,O,L,J,S,N,G,b;return g.P(function(t){if(t.U==1)return A=[],n=g.L4("CacheStorage keys"),g.a(t,ns.keys(),2);O=t.J;L=g.f(O);for(J=L.next();!J.done;J=L.next()){S=J.value;var l=S.indexOf(":");N=l===-1?{AO:S}:{AO:S.substring(0,l),datasyncId:S.substring(l+1)};G=N.AO;b=N.datasyncId;b===n&&A.push(G)}return t.return(A)})};g.d(Ls,g.V);Ls.prototype.C=function(A){this.api.sN("onOfflineOperationFailure",A.data)};
Ls.prototype.L=function(A){this.api.publish("offlinetransferpause",A.data)};
Ls.prototype.h5=function(){var A;(A=this.U)==null||A.close();var n;(n=this.J)==null||n.close()};fmN.prototype.QN=function(){this.U&&Sq(this)};
fmN.prototype.Qa=function(){this.J&&this.J.resolve();this.C=this.U=!1;this.X()};var Jch=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var $jK="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var WDL="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.d(xDK,aK);xDK.prototype.J=function(A){return be(A)?EQR(this,A):tS(A)?MIN(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};g.d(p3R,aK);p3R.prototype.J=function(A){return tS(A)?UDV(this,A):s$V(A)?s2p(this,A):le(A)?gQp(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};g.c=j2K.prototype;g.c.txY=function(A){var n=this,O,L,J,S;return g.P(function(N){if(!g.e(A.state,128))return N.TV(0);O=A.state.jc;var G=(L=O)==null?void 0:L.errorCode,b=(J=O)==null?void 0:J.t0;S=G==="net.connect"&&b===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(G==null?0:G.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.a(N,n.Q$(n.player.getVideoData().videoId,S),0)})};
g.c.Q$=function(A,n){var O=this;return g.P(function(L){if(L.U==1){if(O.J)return L.return();O.J=!0;return n==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?($7(O,A,!1,!0),L.TV(0)):g.a(L,QB(O,A),3)}g.g$(A,4);return g.a(L,O.U.Q$(n),0)})};
g.c.tO=function(A){A.status===2?(A.status!==this.C&&(UKN(this.U),g.g$(A.videoId,2)),A.ZZ&&rcV(this.U,A.videoId,A.ZZ)):A.status===4?(QB(this,A.videoId),this.Q$(A.videoId,A.qK?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):A.status===1&&jHD(this.U);this.C=A.status;this.api.sN("localmediachange",{videoId:A.videoId,status:A.status})};
g.c.YC=function(){var A=this,n;return g.P(function(O){if(O.U==1){if(A.J)return O.return();A.J=!0;n=A.player.getVideoData().videoId;return g.a(O,QB(A,n),2)}return g.a(O,A.U.YC(),0)})};
g.c.U8=function(A){switch(A){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.c.D=function(A){return this.api.K().D(A)};g.d(Q2D,aK);Q2D.prototype.J=function(A){return be(A)?vQL(this,A):tS(A)?BKL(this,A):s$V(A)?VIw(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};kcc.prototype.U=function(A,n){var O=A.action.actionMetadata.priority-n.action.actionMetadata.priority;O===0&&(A.U<n.U?O=-1:A.U>n.U&&(O=1));return O};g.d(vf,g.V);vf.prototype.h5=function(){this.X&&this.X();g.V.prototype.h5.call(this)};
vf.prototype.createAction=function(A,n){var O=g.DP(A.entityKey).entityType,L=g.r_(16);return new da(O,L,A,n.actionId,n.rootActionId)};
vf.prototype.t5=function(A){var n=this,O,L,J,S,N,G,b,t,l;return g.P(function(D){if(D.U==1){if(n.gQ())return D.return();L=(O=A.offlineOrchestrationActionWrapperEntity)!=null?O:new Set;J=[];S=g.f(L);for(N=S.next();!N.done;N=S.next())G=N.value,b=g.DP(G),t=b.entityId,e7h(n.U,t)||J.push(G);return g.a(D,ccK(n,J),2)}l=D.J;return g.a(D,NoL(n,l),0)})};
vf.prototype.retry=function(){var A=this;return g.P(function(n){return g.a(n,G13(A),0)})};tsR.prototype.SO=function(A,n){n=n===void 0?!0:n;var O=this,L,J,S,N,G,b,t,l;return g.P(function(D){switch(D.U){case 1:if(!O.U)return D.return();L=[];J=g.l_(O.U.J,n);S=[];for(N={S4:0};N.S4<J.length;N={S4:N.S4},N.S4++)G=J[N.S4],b=O.U.MF(G,"json3"),t=g.vt(b,{withCredentials:!0,format:"RAW"},3,500).then(function(Y){return function(m){m={metadata:g.YP(J[Y.S4]),trackData:m.xhr.responseText};S.push(m)}}(N)).QM(function(Y){Oz("Caption fetch error",Y)}),L.push(t);
return g.a(D,rRD(L),2);case 2:return g.EC(D,3),g.a(D,X4K(A,S),5);case 5:g.ij(D,0);break;case 3:l=g.M5(D),Oz("Caption DB transaction error",l),g.Kx(D)}})};g.d(Bf,g.V);Bf.prototype.h5=function(){this.J&&this.J();g.V.prototype.h5.call(this)};
Bf.prototype.C=function(A){var n=this,O,L,J,S,N,G,b,t;return g.P(function(l){L=(O=A.transfer)!=null?O:new Set;J=[];S=g.f(L);for(N=S.next();!N.done;N=S.next())G=N.value,b=g.DP(G),t=b.entityId,J.push(t);return J.length===0?l.return():g.a(l,YT6(n,J),0)})};g.d(fYc,g.V);g.c=fYc.prototype;g.c.h5=function(){this.aB&&this.aB();this.oB.dispose();this.L.dispose();this.A5&&g.wf(this.Z.A_,this.A5);this.Hs&&g.wf(this.Z.A_,this.Hs);g.V.prototype.h5.call(this)};
g.c.pmg=function(A){var n=this,O,L,J;return g.P(function(S){switch(S.U){case 1:O=g.YU(A,"transfer");if(n.U&&O===n.U.key){$7(n.W,n.B,!0);n.L.stop();S.TV(0);break}return g.a(S,wT(n.J,{mode:"readwrite",iA:!0},function(N){return VT(N,O,"transfer").then(function(G){if(G&&G.transferState!=="TRANSFER_STATE_COMPLETE"&&G.transferState!=="TRANSFER_STATE_FAILED")return G.transferState="TRANSFER_STATE_PAUSED_BY_USER",zz(N,G,"transfer").then(function(){return G})})}),3);
case 3:L=S.J;if(!L){S.TV(0);break}if(!A||!n.C){S.TV(5);break}return g.a(S,DD(A,n.C,n.J,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.a(S,hS(n,A),7);case 7:J=S.J,Ujp({videoId:A,Ow:L,offlineModeType:J}),g.Kx(S)}})};
g.c.k0Y=function(){var A=this;if(this.U&&this.B){$7(this.W,this.B,!1);var n=this.U,O=(n==null?0:n.key)?g.DP(n.key).entityId:"";O&&this.C&&(new Promise(function(L,J){DD(O,A.C,A.J,"DOWNLOAD_STATE_PAUSED").catch(function(S){J(S)})})).catch(function(L){Oz("Download state setting error",L)})}this.L.stop()};
g.c.rd=function(){this.U?Cih(this,this.U):RK(this)};
g.c.c5=function(A){var n=this;return g.P(function(O){switch(O.U){case 1:if(!n.U){O.TV(2);break}if(n.U.transferState==="TRANSFER_STATE_COMPLETE"||n.U.transferState==="TRANSFER_STATE_FAILED"||!A.transfer||!A.transfer.has(n.U.key)){O.TV(3);break}return g.a(O,e2(n.J,n.U.key,"transfer"),4);case 4:n.U=O.J;if(n.U){O.TV(3);break}return g.a(O,iAp(n),3);case 3:if(n.U)return O.return();case 2:return g.a(O,RK(n),0)}})};
g.c.Q$=function(A,n){var O=this,L,J,S,N,G;return g.P(function(b){switch(b.U){case 1:if(!O.U){zv(O,"onTransferFailure: "+A);b.TV(2);break}L=O.U;S=((J=L)==null?0:J.key)?g.DP(L.key).entityId:"";a:switch(A){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var t=!1;break a;default:t=!0}return t&&aYN(O)?g.a(b,oK(O,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.a(b,
uZh(O,A),5);case 5:if(!S||!O.C){b.TV(2);break}return g.a(b,DD(S,O.C,O.J,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.a(b,hS(O,S),9);case 9:N=b.J;cf({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:S,Ow:L,offlineModeType:N});if(!S||!O.C){b.TV(2);break}return g.a(b,DD(S,O.C,O.J,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:VB(O),G=RK(O,!0),n&&n(G),g.Kx(b)}})};
g.c.YC=function(A){var n=this,O,L,J,S,N,G,b,t,l,D,Y,m;return g.P(function(T){switch(T.U){case 1:if(!n.U){zv(n,"onMaybeTransferStreamsExpired");T.TV(2);break}return aYN(n)?g.a(T,oK(n,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.a(T,uZh(n,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!n.C){T.TV(2);break}O=n.U;J=((L=O)==null?0:L.key)?g.DP(O.key).entityId:"";if(!J){T.TV(2);break}return g.a(T,DD(J,n.C,n.J,"DOWNLOAD_STATE_FAILED"),2);case 9:return n.U||zv(n,"onMaybeTransferStreamsExpiredRetryAttempting"),
S=n.U,G=((N=S)==null?0:N.key)?g.DP(S.key).entityId:"",g.a(T,hS(n,G),10);case 10:return b=T.J,cf({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:G,Ow:S,offlineModeType:b}),t=amd(),g.kN(t,yB,{isEnqueuedForExpiredStreamUrlRefetch:!0}),l=g.YU(G,"playbackData"),D={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:l,actionMetadata:t},Y=fs(new da("playbackData",G,D)),g.a(T,Wa(n.J,Y,"offlineOrchestrationActionWrapperEntity"),2);case 2:VB(n),m=RK(n,!0),
A&&A(m),g.Kx(T)}})};
var Qch={},Pir=(Qch.TRANSFER_STATE_TRANSFERRING=1,Qch.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,Qch);g.c=qd.prototype;g.c.NV=function(){return this.B.promise};
g.c.sy=function(){if(this.J&&this.W)return this.B.promise;QHc(this).then(this.B.resolve).catch(this.B.reject);return this.B.promise};
g.c.nX=function(A){var n={};return n.playbackData=new xDK(A,this.UN,this.U),n.transfer=new Q2D(A,this.UN),n.videoPlaybackPositionEntity=new p3R(A,this.UN),n};
g.c.JS=function(){var A=this;return g.P(function(n){return A.J?g.a(n,Kiw(A.J),0):n.TV(0)})};
g.c.Oy=function(){var A=this,n,O;return g.P(function(L){if(L.U==1)return A.J||A.W?g.a(L,A.NV(),2):L.return();A.G!==void 0&&(g.sB(A.G),A.G=void 0);A.L!==void 0&&(g.sB(A.L),A.L=void 0);(n=A.J)==null||n.dispose();A.J=void 0;(O=A.W)==null||O.dispose();A.W=void 0;A.api.sN("onOrchestrationLostLeader");A.B=new g.i6;g.Kx(L)})};
g.c.isOrchestrationLeader=function(){return this.C.U};
g.c.X7=function(){return g.P(function(A){return A.return(!1)})};
g.c.AQ=function(A){var n=this.U;n.api.publish("offlinetransferpause",A);var O;(O=n.J)==null||O.postMessage(A)};
g.c.rd=function(A){var n,O;return g.P(function(L){if(L.U==1)return g.a(L,XK(),2);n=L.J;if(!n)return L.return();O=g.YU(A,"transfer");return g.a(L,wT(n,{mode:"readwrite",iA:!0},function(J){var S=VT(J,O,"transfer"),N=VT(J,g.YU(A,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.uO.all([S,N]).then(function(G){G=g.f(G);var b=G.next().value;var t=G.next().value;return b&&b.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(b.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",zz(J,b,"transfer").then(function(){cf({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:A,Ow:b,offlineModeType:t==null?void 0:t.offlineModeType});return g.uO.resolve(null)})):g.uO.resolve(null)})}),0)})};
g.c.Eu=function(A){A=A===void 0?43200:A;var n=this,O,L,J,S,N,G,b,t;return g.P(function(l){if(l.U==1)return n.Z.Ab()?g.a(l,XK(),2):l.return($KV());if(l.U!=3){O=l.J;if(!O)return l.return([]);L=Date.now()/1E3;return g.a(l,FK(O,"offlineVideoPolicy"),3)}J=l.J;S=[];N=g.f(J);for(G=N.next();!G.done;G=N.next())b=G.value,Number(b.lastUpdatedTimestampSeconds)+A<=L&&(t=g.DP(b.key).entityId,S.push(t));return S.length?l.return(k7(n,S,n.X,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):l.return([])})};
g.c.deleteAll=function(){return k7(this,["!*$_ALL_ENTITIES_!*$"],this.X,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.c.refreshAllStaleEntities=function(A){var n=this;return g.P(function(O){return O.U==1?g.a(O,n.Eu(A),2):O.return(O.J)})};
g.c.setUpPositionSyncInterval=function(A){var n=this;this.L!==void 0&&(g.sB(this.L),this.L=void 0);var O=A!=null?A:864E5;this.L=g.UB(function(){n.SW(O)},O)};
g.c.SW=function(A){var n=this,O,L,J,S,N,G;return g.P(function(b){switch(b.U){case 1:return g.EC(b,2),g.a(b,$y.getInstance(),4);case 4:O=b.J;if(!O)throw Error("prefStorage is undefined");return g.a(b,O.get("psi"),5);case 5:L=b.J;S=((J=L)==null?0:J.vD)?Number(L.vD)/1E3:0;N=Date.now();if(!(S+A<=N)){b.TV(6);break}return g.a(b,k7(n,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.ij(b,0);break;case 2:G=g.M5(b),Oz("Offline manager error",G),
g.Kx(b)}})};
g.c.F0=function(){var A=this,n,O,L,J,S,N,G;return g.P(function(b){if(b.U==1)return g.a(b,XK(),2);if(b.U!=3)return(n=b.J)?g.a(b,FK(n,"transfer"),3):b.return([]);O=b.J;L=[];J=g.f(O);for(S=J.next();!S.done;S=J.next())N=S.value,N.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&N.key&&(G=g.DP(N.key).entityId,L.push(G));return b.return(BoW(A,L))})};
g.c.jG=function(){return g.P(function(A){return A.return([])})};
g.c.Km=function(){return g.P(function(A){g.Kx(A)})};
g.c.dh=function(){return g.P(function(A){g.Kx(A)})};g.d(VsL,aK);VsL.prototype.J=function(A){return be(A)?zOp(this,A):tS(A)?qT3(this,A):le(A)?k1D(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};
var wa=[10];g.d(XND,aK);XND.prototype.J=function(A){return be(A)?nwd(this,A):tS(A)?OGN(this,A):le(A)?Lur(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};
var Apw=[10];g.d(S9h,aK);S9h.prototype.J=function(A){return tS(A)?cpW(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};g.d(GUr,qd);g.c=GUr.prototype;g.c.nX=function(A){var n=qd.prototype.nX.call(this,A);n.mainVideoEntity=new XND(A,this.UN,this.U);n.mainPlaylistEntity=new VsL(A,this.UN,this.U);n.mainDownloadsListEntity=new S9h(A,this.UN,this.U);return n};
g.c.refreshAllStaleEntities=function(A,n){var O=this,L,J,S,N,G,b,t,l,D,Y,m;return g.P(function(T){switch(T.U){case 1:L=[];if(!O.UN.D("web_player_offline_playlist_auto_refresh")){T.TV(2);break}return g.a(T,bGL(O,A,n),3);case 3:L=T.J;case 2:return g.a(T,$y.getInstance(),4);case 4:return J=T.J,g.a(T,(S=J)==null?void 0:S.get("sdois"),5);case 5:return N=T.J,g.a(T,(G=J)==null?void 0:G.get("lmqf"),6);case 6:b=T.J;if(!N){T.TV(7);break}l=L;D=l.concat;return g.a(T,t8c(O,N,(t=b)!=null?t:"SD",A===0),8);case 8:L=
D.call(l,T.J);case 7:return Y=L,m=Y.concat,g.a(T,qd.prototype.refreshAllStaleEntities.call(O,A,n),9);case 9:return L=m.call(Y,T.J),T.return(L)}})};
g.c.X7=function(A){var n,O,L,J,S,N,G,b;return g.P(function(t){if(t.U==1)return g.a(t,XK(),2);if(t.U!=3)return(n=t.J)?g.a(t,e2(n,g.uW,"mainDownloadsListEntity"),3):t.return(!1);O=t.J;if((L=O)==null?0:(J=L.downloads)==null?0:J.length)for(S=g.YU(A,"mainVideoEntity"),N=g.f(O.downloads),G=N.next();!G.done;G=N.next())if(b=G.value,b.videoItem===S)return t.return(!0);return t.return(!1)})};
g.c.jG=function(){var A=this,n,O,L,J,S,N,G,b;return g.P(function(t){if(t.U==1)return g.a(t,XK(),2);if(t.U!=3)return(n=t.J)?g.a(t,FK(n,"downloadStatusEntity"),3):t.return([]);O=t.J;L=[];J=g.f(O);for(S=J.next();!S.done;S=J.next())N=S.value,N.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&N.key&&(G=g.DP(N.key).entityId,L.push(G));return L.length?(b={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},t.return(k7(A,L,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
b))):t.return([])})};
g.c.dh=function(){var A;return g.P(function(n){return n.U==1?g.a(n,XK(),2):(A=n.J)?g.a(n,wT(A,{mode:"readwrite",iA:!0},function(O){return Re(O,"mainVideoEntity").then(function(L){var J=[];L=g.f(L);for(var S=L.next();!S.done;S=L.next()){S=S.value;var N=void 0;(N=S.userState)!=null&&N.playbackPosition||(N=g.DP(S.key).entityId,N={key:g.YU(N,"videoPlaybackPositionEntity"),videoId:N,lastPlaybackPositionSeconds:"0"},J.push(zz(O,N,"videoPlaybackPositionEntity")),S.userState={playbackPosition:N.key},J.push(zz(O,
S,"mainVideoEntity")))}return g.uO.all(J)})}),0):n.return()})};
g.c.Km=function(){var A,n,O,L,J,S,N,G,b,t,l,D,Y,m,T,K,C,p,H,u,I,B,q,W,Ju,cj,Au,z,F,x,k,ZU,CW,nW,sC,e5,LW,dd;return g.P(function(M){if(M.U==1)return g.a(M,XK(),2);if(M.U!=3){A=M.J;if(!A)return M.return();n=g.YU("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.a(M,wT(A,{mode:"readonly",iA:!0},function(U){return g.uO.all([VT(U,n,"mainDownloadsListEntity"),VT(U,g.uW,"mainDownloadsListEntity"),Re(U,"mainVideoEntity"),Re(U,"mainPlaylistEntity")])}),3)}O=M.J;
L=g.f(O);J=L.next().value;S=L.next().value;N=L.next().value;G=L.next().value;b=J;t=S;l=N;D=G;Y=new Set;if((m=b)==null?0:(T=m.downloads)==null?0:T.length)for(K=g.f(b.downloads),C=K.next();!C.done;C=K.next())p=C.value,H=void 0,(u=(H=p.videoItem)!=null?H:p.playlistItem)&&Y.add(u);if((I=t)==null?0:(B=I.downloads)==null?0:B.length)for(q=g.f(t.downloads),W=q.next();!W.done;W=q.next())Ju=W.value,Ju.videoItem&&Y.add(Ju.videoItem);cj=new Set;Au=[];z=g.f(D);for(F=z.next();!F.done;F=z.next()){x=F.value;if(x.videos)for(k=
g.f(x.videos),ZU=k.next();!ZU.done;ZU=k.next())CW=ZU.value,(nW=JSON.parse(g.DP(CW).entityId).videoId)&&cj.add(nW);x.key&&!Y.has(x.key)&&Au.push(x.key)}sC=g.f(l);for(e5=sC.next();!e5.done;e5=sC.next())LW=e5.value,LW.key&&!Y.has(LW.key)&&(dd=g.DP(LW.key).entityId,cj.has(dd)||Au.push(LW.key));return Au.length?g.a(M,olp(A,Au),0):M.TV(0)})};g.d(lIh,aK);lIh.prototype.J=function(A){return be(A)?Y93(this,A):tS(A)?mpw(this,A):le(A)?TYD(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};
var eq=[10];g.d(xpp,aK);xpp.prototype.J=function(A){return be(A)?Kuw(this,A):tS(A)?Ewh(this,A):le(A)?CxR(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};
var Fy=[10];g.d(pyW,aK);pyW.prototype.J=function(A){return be(A)?gw6(this,A):tS(A)?jcD(this,A):le(A)?rpW(this,A):Promise.reject(Error("Unsupported action type: "+A.actionType))};
var scw=[10];g.d(Xy,qd);Xy.prototype.nX=function(A){var n=qd.prototype.nX.call(this,A);n.musicTrack=new pyW(A,this.U);n.musicPlaylist=new xpp(A,this.U);n.musicAlbumRelease=new lIh(A,this.U);return n};
Xy.prototype.refreshAllStaleEntities=function(A,n){var O=this,L,J,S;return g.P(function(N){if(N.U==1)return g.a(N,uwR(O,A,n),2);if(N.U!=3)return J=L=N.J,S=J.concat,g.a(N,qd.prototype.refreshAllStaleEntities.call(O,A,n),3);L=S.call(J,N.J);return N.return(L)})};g.d(Px3,g.Ma);g.c=Px3.prototype;g.c.create=function(){var A=this;g.R(this,this.events);g.Wp(this.UN)?this.U=new GUr(this.UN,this.player):g.zD(this.UN)&&(this.U=new Xy(this.UN,this.player));this.events.Y(this.player,"onPlaybackStartExternal",function(){A.xu()});
this.events.Y(this.player,"videodatachange",function(){A.xu()});
this.UN.D("html5_offline_playback_position_sync")&&this.events.Y(this.player,"presentingplayerstatechange",this.E8)};
g.c.u2=function(){return!1};
g.c.oT=function(A,n,O,L){var J=this;return g.P(function(S){return J.U?S.return(k7(J.U,A,n,O,L)):S.return(Promise.reject())})};
g.c.deleteAll=function(){return this.U.deleteAll()};
g.c.Eu=function(A){return this.U.Eu(A)};
g.c.refreshAllStaleEntities=function(A){return this.U.refreshAllStaleEntities(A)};
g.c.setUpPositionSyncInterval=function(A){this.U.setUpPositionSyncInterval(A)};
g.c.AQ=function(A){this.U.AQ(A)};
g.c.rd=function(A){return this.U.rd(A)};
g.c.xu=function(){var A=this,n;return g.P(function(O){n=A.player.getVideoData();return g.eb(n)?yph(n)&&A.J!==n.clientPlaybackNonce?g.a(O,IIh(A,n),0):O.TV(0):O.return()})};
g.c.E8=function(A){var n=this,O,L,J,S,N,G,b;return g.P(function(t){if(t.U==1)return O=n.player.getVideoData(),L=O.GO,g.Cm(A,2)||g.Cm(A,512)?g.a(t,XK(),2):t.return();if(t.U!=3){J=t.J;if(!J)return Oz("PES is undefined"),t.return();S=O.videoId;return g.a(t,e2(J,g.YU(S,"mainVideoEntity"),"mainVideoEntity"),3)}N=t.J;if(!N)return t.return();G=Math.floor(L).toString();b={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:G}};return g.a(t,n.oT([S],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
b),0)})};
g.c.isOrchestrationLeader=function(){return this.U.isOrchestrationLeader()};
g.c.updateDownloadState=function(A,n){var O,L,J,S;return g.P(function(N){if(N.U==1)return g.a(N,XK(),2);O=N.J;if(!O)return Oz("PES is undefined"),N.return();L=g.DP(A);J=L.entityType;S=L.entityId;return g.a(N,DD(S,J,O,n,!0),0)})};g.i_("offline",Px3);})(_yt_player);
